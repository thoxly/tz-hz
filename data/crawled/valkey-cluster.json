{
  "doc_id": "valkey-cluster",
  "url": "https://elma365.com/ru/help/business_solutions/ru/help/platform/valkey-cluster.html",
  "title": "Кластер Valkey",
  "breadcrumbs": [
    "ELMA365 On-Premises",
    "Подготовка инфраструктуры ELMA365 On-Premises"
  ],
  "section": "ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises | [business_solutions]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Кластер Valkey</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"Valkey — высокопроизводительная NoSQL СУБД, разработанная на основе Redis для современных облачных и распределённых систем.\" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/platform/valkey-cluster.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p><a href=\"elma365-on-premises.html\">ELMA365 On-Premises</a> &gt; <a href=\"infrastructure-preparation.html\">Подготовка инфраструктуры ELMA365 On-Premises</a> &gt; Базы данных &gt; Отказоустойчивая инфраструктура / Кластер Valkey</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Кластер Valkey</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Valkey — высокопроизводительная NoSQL СУБД, разработанная на основе Redis для современных облачных и распределённых систем.</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">В статье приведена установка Valkey 8.1.1 для ОС Ubuntu Linux 22.04 и 24.04. Вы можете найти установочные файлы Valkey для вашей операционной системы в следующих ресурсах:</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0000ff;\"><a class=\"weblink\" href=\"https://github.com/valkey-io/valkey/releases\" target=\"_blank\">официальный репозиторий Valkey</a></span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0000ff;\"><a class=\"weblink\" href=\"https://repology.org/project/valkey/versions\" target=\"_blank\">сайт сервиса Repology</a></span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li></ul>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Ознакомиться с дополнительной информацией о Valkey можно также в источниках:</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"elma365-enterprise-on-premises.html#valkey\">«Системные требования ELMA365 On-Premises»</a> — поддерживаемые версии Valkey для корректной работы системы;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"cluster-redis-to-valkey.html\">«Переход с кластера Redis на кластер Valkey»</a> — как заменить кластер Redis на кластер Valkey;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0000ff;\"><a class=\"weblink\" href=\"https://valkey.io/topics/quickstart/\" target=\"_blank\">официальная документация Valkey</a> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">— подробнее о работе с СУБД.</span></li></ul>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Развёртывание кластера Valkey включает этапы:</span></p>\n<ol style=\"list-style-type:decimal\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"valkey-cluster.html#prepare-servers\">Подготовка нод (серверов)</a>.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"valkey-cluster.html#install-valkey\">Установка Valkey</a>.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"valkey-cluster.html#configure-valkey\">Настройка Valkey</a>.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0a141e;\"><a class=\"topiclink\" href=\"valkey-cluster.html#sentinel\">Настройка Sentinel</a>.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"5\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"topiclink\" href=\"valkey-cluster.html#connect-valkey\">Подключение к Valkey</a>.</span></li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"prepare-servers\"></a><span class=\"f_Heading2\">Шаг 1. Подготовка нод (серверов)</span></h2>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">начало внимание</span></p>\n<p class=\"p_Normal\">Минимальное количество серверов для организации кластера — три.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец внимание</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Создайте три ноды (сервера) с последовательно пронумерованными именами хостов:</span></li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server2.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server3.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li></ul>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Создайте необходимые сопоставления имён хостов в DNS. Если такой возможности нет, внесите нужные записи в папке </span><code><b>/etc/hosts</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"install-valkey\"></a><span class=\"f_Heading2\">Шаг 2. Установка Valkey</span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Установите пакеты:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt install -y apt-transport-https ca-certificates curl</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Импортируйте ключи:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo curl -fsSL https://repo.elma365.tech/deb/elma365-keyring.gpg | gpg --dearmor &gt; /etc/apt/trusted.gpg.d/elma365-keyring.gpg</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте репозиторий ELMA365:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">echo \"deb [arch=amd64] https://repo.elma365.tech/deb $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/elma365.list</span><br/>\n<span class=\"f_CodeExample\">sudo apt update</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Установите Valkey:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt install elma365-valkey-server</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"configure-valkey\"></a><span class=\"f_Heading2\">Шаг 3. Настройка Valkey</span></h2>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">начало примечание</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">Примечание</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Для пароля разрешается применять следующие символы:</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">заглавные латинские буквы: от A до Z;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">строчные латинские буквы: от a до z;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">цифры от 0 до 9;</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">символы:  -_.</span></li></ul>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Зарезервированные (недопустимые) символы:</span></p>\n<p style=\"margin: 7px 0 7px 30px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">! * ' ( ) ; : @ &amp; = + $ , / ? % # [ ]</span></p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец примечание</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте настройки для установленной СУБД:</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отредактируйте файл </span><code><b>/etc/valkey/valkey.conf</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на каждом из серверов:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo nano /etc/valkey/valkey.conf</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-size: 15px; font-family: Helvetica,'Helvetica Light',Roboto,Arial,sans-serif; color: #333333; background-color: #ffffff;\">Чтобы разрешить подключение к Valkey со всех сетевых интерфейсов сервера, </span><span style=\"font-size: 15px; font-family: Calibri,Vectora,'Droid Sans','Open Sans',Frutiger,sans-serif; color: #333333; background-color: #ffffff;\">укажите</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">bind 0.0.0.0 </span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Увеличьте максимальное количество клиентов, изменив значение параметра </span><code><b>maxclients</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на </span><code><b>20000</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">. Раскомментируйте строку, убрав знак </span><code><b>#</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">maxclients 20000</span></p>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте политику вытеснения ключей, изменив значение параметра </span><code><b>maxmemory-policy</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на </span><code><b>allkeys-lfu</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">. Раскомментируйте строку, убрав знак </span><code><b>#</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">maxmemory-policy allkeys-lfu</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"5\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отключите создание </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">snapshots</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">, изменив значение параметра </span><code><b>save</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на пустую</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\"> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">строку. Раскомментируйте строку, убрав знак </span><code><b>#</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">save \"\"</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"6\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отключите </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">AOF</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> (</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">Append Only File)</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">,</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\"> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">чтобы данные Valkey не сохранялись в файл. Для этого замените значение параметра </span><code><b>appendonly</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на </span><code><b>no</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">. Раскомментируйте строку, убрав знак </span><code><b>#</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">appendonly no</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"7\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Укажите пароль к master-ноде:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">masterauth SecretPassword</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"8\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте домен (FQDN) для представления ноды в кластере:</span></li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip valkey-server1.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server2.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip valkey-server2.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server3.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip valkey-server3.your_domain</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"9\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте пароль для доступа:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">requirepass SecretPassword</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"10\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отключите защищённый режим, если используется параметр </span><code><b>bind 0.0.0.0</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #404040;\"> или отсутствует настройка </span><code><b>requirepass</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">protected-mode no</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"11\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">На нодах </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server2.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> и </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server3.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> укажите домен (FQDN) и порт для подключения к master-ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">replicaof valkey-server1.your_domain 6379</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"12\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Перезапустите все сервера. Начните с master-ноды, а затем перейдите к slave-нодам:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart valkey-server</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable valkey-server</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"13\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Проверьте статус репликации на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -a SecretPassword info replication</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A1')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Настройка включения TLS/SSL в Valkey</a></span></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A1\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 7px 0 7px 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px; color: #000000;\"> </span><br/>\n<span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Чтобы включить поддержку TLS/SSL в Valkey, в файле конфигурации </span><code><b>valkey.conf</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></p>\n<ol style=\"list-style-type:decimal\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отключите незащищённые подключения, выставив в параметре </span><code><b>port</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\"> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">значение </span><code><b>0</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте порт для TLS‑подключений и раскомментируйте параметр </span><code><b>tls-port</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">В параметре </span><code><b>tls-cert-file</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> укажите путь к файлу сертификата сервера.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">В параметре </span><code><b>tls-key-file</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> укажите путь к файлу закрытого ключа.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"5\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">В параметре </span><code><b>tls-ca-cert-file</b></code><span style=\"font-size: 13px;\"> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">укажите путь к файлу корневого CA.</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">port 0</span><br/>\n<span class=\"f_CodeExample\">tls-port 6379</span><br/>\n<span class=\"f_CodeExample\">tls-cert-file /path/to/valkey.crt</span><br/>\n<span class=\"f_CodeExample\">tls-key-file /path/to/valkey.key</span><br/>\n<span class=\"f_CodeExample\">tls-ca-cert-file /path/to/ca.crt</span></p>\n<ol style=\"list-style-type:decimal\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"6\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Перезапустите все сервера. Начните с master-ноды, а затем перейдите к slave-нодам:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart valkey-server</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable valkey-server</span></p>\n<ol style=\"list-style-type:decimal\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"7\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Проверьте статус репликации на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -p 6379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key -a SecretPassword info replication</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px; color: #000000;\"> </span><br/>\n<span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Подробнее о настройке TLS/SSL в Valkey читайте в </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0000ff;\"><a class=\"weblink\" href=\"https://valkey.io/topics/encryption/\" target=\"_blank\">официальной документации Valkey</a></span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"sentinel\"></a><span class=\"f_Heading2\">Шаг 4. Настройка Sentinel</span></h2>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px; color: #394149;\">Чтобы настроить Sentinel,</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> отредактируйте файл </span><code><b>/etc/valkey/sentinel.conf</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> на каждом из серверов.</span></p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">началов внимание</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px; color: #394149;\">Для корректной работы соблюдайте указанный порядок записей в файле</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> </span><code><b>/etc/valkey/sentinel.conf</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец внимание</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Укажите домен (FQDN) для представления нод Sentinel:</span></li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip valkey-server1.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server2.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip valkey-server2.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server3.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip valkey-server3.your_domain</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Настройте домен (FQDN) и порт master-ноды, а также значение для достижения кворума:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel monitor mymaster valkey-server1.your_domain 6379 2</span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте пароль для доступа к master-ноде:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel auth-pass mymaster SecretPassword</span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Установите время, после которого master-нода будет считаться вышедшей из строя:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel down-after-milliseconds mymaster 3000</span></p>\n<ol start=\"5\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"5\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Укажите время ожидания после смены ролей slave-ноды на master-ноду, если master-нода вышла из строя:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel failover-timeout mymaster 6000</span></p>\n<ol start=\"5\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"6\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Разрешите использовать имена хостов:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel resolve-hostnames yes</span><br/>\n<span class=\"f_CodeExample\">sentinel announce-hostnames yes</span></p>\n<ol start=\"5\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"7\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Опционально: включите доступ только по паролю для пользователя </span><code><b>default</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">user default on &gt;SecretPassword sanitize-payload ~* &amp;* +@all</span></p>\n<ol start=\"8\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"8\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Перезапустите все сервера:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart valkey-sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable valkey-sentinel</span></p>\n<ol start=\"9\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"9\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Проверьте статус Sentinel и состояние кворума на ноде </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\">valkey-server1.your_domain</span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">для подключения без TLS/SSL:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -p 26379 info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo valkey-cli -p 26379 sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">для подключения без TLS/SSL, если включён доступ только по паролю:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -a SecretPassword info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -a SecretPassword sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">для подключения с TLS/SSL:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">для подключения с TLS/SSL, если включён доступ только по паролю:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -a SecretPassword -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo valkey-cli -p 26379 -a SecretPassword -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key sentinel ckquorum mymaster</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A2')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Настройка включения TLS/SSL в Sentinel</a></span></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A2\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 7px 0 7px 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p style=\"margin: 7px 0 7px 0;\"><span style=\"font-size: 13px; color: #000000;\"> </span><br/>\n<span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Чтобы включить поддержку TLS/SSL в Sentinel, в файле конфигурации </span><code><b>sentinel.conf</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">:</span></p>\n<ol style=\"list-style-type:decimal\">\n<li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"1\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Отключите незащищённые подключения, выставив в параметре </span><code><b>port</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; font-weight: bold;\"> </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">значение </span><code><b>0</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"2\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Задайте порт для TLS‑подключений, добавив параметр </span><code><b>tls-port</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"3\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте параметр </span><code><b>tls-cert-file</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> и укажите в нём путь к файлу сертификата сервера.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"4\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте параметр </span><code><b>tls-key-file</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> и укажите в нём путь к файлу закрытого ключа.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"5\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте параметр </span><code><b>tls-ca-cert-file</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> и укажите в нём путь к файлу корневого CA.</span></li><li style=\"margin-top: 7px; margin-right: 0; margin-bottom: 7px;\" value=\"6\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Добавьте параметр </span><code><b>tls-replication</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\"> и включите в нём поддержку TLS, указав значение </span><code><b>yes</b></code><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">port 0</span><br/>\n<span class=\"f_CodeExample\">tls-port 26379</span><br/>\n<span class=\"f_CodeExample\">tls-cert-file /path/to/valkey.crt</span><br/>\n<span class=\"f_CodeExample\">tls-key-file /path/to/valkey.key</span><br/>\n<span class=\"f_CodeExample\">tls-ca-cert-file /path/to/ca.crt</span><br/>\n<span class=\"f_CodeExample\">tls-replication yes</span></p>\n<p style=\"margin: 7px 0 7px 61px;\"><span style=\"font-size: 13px; color: #000000;\"> </span><br/>\n<span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Подробнее о настройке TLS/SSL в Sentinel читайте в </span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif; color: #0000ff;\"><a class=\"weblink\" href=\"https://valkey.io/topics/sentinel-clients/\" target=\"_blank\">официальной документации Valkey</a></span><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">.</span></p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"connect-valkey\"></a><span class=\"f_Heading2\">Шаг 5. Подключение к Valkey</span></h2>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Строка для подключения к Valkey:</span></p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">redis://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Строка для подключения к Valkey, если включён доступ только по паролю:</span></p>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">redis://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster&amp;sentinelUsername=default&amp;sentinelPassword=SecretPassword</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Строка для подключения к Valkey c TLS/SSL:</span></p>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">rediss://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?&amp;masterName=mymaster</span></p>\n<p style=\"margin: 7px 0 7px 0;\"><span style=\"font-family: 'Times New Roman',Times,Georgia,serif;\">Строка для подключения к Valkey c TLS/SSL, если включён доступ только по паролю:</span></p>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">rediss://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster&amp;sentinelUsername=default&amp;sentinelPassword=SecretPassword</span></p>\n<p style=\"margin: 7px 0 7px 30px;\"><span style=\"font-size: 13px; color: #000000;\"> </span></p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"configure-mongodb.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">configure-mongodb.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"cluster-redis-to-valkey.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">cluster-redis-to-valkey.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n<script type=\"text/javascript\">\nHMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A2','hm.type','dropdown','hm.state','0');\n</script>\n</body>\n</html>\n",
  "plain_text": "Кластер Valkey ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises > Базы данных > Отказоустойчивая инфраструктура / Кластер Valkey Кластер Valkey Valkey — высокопроизводительная NoSQL СУБД, разработанная на основе Redis для современных облачных и распределённых систем. В статье приведена установка Valkey 8.1.1 для ОС Ubuntu Linux 22.04 и 24.04. Вы можете найти установочные файлы Valkey для вашей операционной системы в следующих ресурсах: официальный репозиторий Valkey ; сайт сервиса Repology . Ознакомиться с дополнительной информацией о Valkey можно также в источниках: «Системные требования ELMA365 On-Premises» — поддерживаемые версии Valkey для корректной работы системы; «Переход с кластера Redis на кластер Valkey» — как заменить кластер Redis на кластер Valkey; официальная документация Valkey — подробнее о работе с СУБД. Развёртывание кластера Valkey включает этапы: Подготовка нод (серверов) . Установка Valkey . Настройка Valkey . Настройка Sentinel . Подключение к Valkey . Шаг 1. Подготовка нод (серверов) начало внимание Минимальное количество серверов для организации кластера — три. конец внимание Создайте три ноды (сервера) с последовательно пронумерованными именами хостов: valkey-server1.your_domain ; valkey-server2.your_domain ; valkey-server3.your_domain . Создайте необходимые сопоставления имён хостов в DNS. Если такой возможности нет, внесите нужные записи в папке /etc/hosts . Шаг 2. Установка Valkey Установите пакеты: sudo apt install -y apt-transport-https ca-certificates curl Импортируйте ключи: sudo curl -fsSL https://repo.elma365.tech/deb/elma365-keyring.gpg | gpg --dearmor > /etc/apt/trusted.gpg.d/elma365-keyring.gpg Добавьте репозиторий ELMA365: echo \"deb [arch=amd64] https://repo.elma365.tech/deb $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/elma365.list sudo apt update Установите Valkey: sudo apt install elma365-valkey-server Шаг 3. Настройка Valkey начало примечание Примечание Для пароля разрешается применять следующие символы: заглавные латинские буквы: от A до Z; строчные латинские буквы: от a до z; цифры от 0 до 9; символы: -_. Зарезервированные (недопустимые) символы: ! * ' ( ) ; : @ & = + $ , / ? % # [ ] конец примечание Задайте настройки для установленной СУБД: Отредактируйте файл /etc/valkey/valkey.conf на каждом из серверов: sudo nano /etc/valkey/valkey.conf Чтобы разрешить подключение к Valkey со всех сетевых интерфейсов сервера, укажите : bind 0.0.0.0 Увеличьте максимальное количество клиентов, изменив значение параметра maxclients на 20000 . Раскомментируйте строку, убрав знак # : maxclients 20000 Задайте политику вытеснения ключей, изменив значение параметра maxmemory-policy на allkeys-lfu . Раскомментируйте строку, убрав знак # : maxmemory-policy allkeys-lfu Отключите создание snapshots , изменив значение параметра save на пустую строку. Раскомментируйте строку, убрав знак # : save \"\" Отключите AOF ( Append Only File) , чтобы данные Valkey не сохранялись в файл. Для этого замените значение параметра appendonly на no . Раскомментируйте строку, убрав знак # : appendonly no Укажите пароль к master-ноде: masterauth SecretPassword Задайте домен (FQDN) для представления ноды в кластере: на ноде valkey-server1.your_domain : replica-announce-ip valkey-server1.your_domain на ноде valkey-server2.your_domain : replica-announce-ip valkey-server2.your_domain на ноде valkey-server3.your_domain : replica-announce-ip valkey-server3.your_domain Добавьте пароль для доступа: requirepass SecretPassword Отключите защищённый режим, если используется параметр bind 0.0.0.0 или отсутствует настройка requirepass : protected-mode no На нодах valkey-server2.your_domain и valkey-server3.your_domain укажите домен (FQDN) и порт для подключения к master-ноде valkey-server1.your_domain : replicaof valkey-server1.your_domain 6379 Перезапустите все сервера. Начните с master-ноды, а затем перейдите к slave-нодам: sudo systemctl restart valkey-server sudo systemctl enable valkey-server Проверьте статус репликации на ноде valkey-server1.your_domain : sudo valkey-cli -a SecretPassword info replication Настройка включения TLS/SSL в Valkey Чтобы включить поддержку TLS/SSL в Valkey, в файле конфигурации valkey.conf : Отключите незащищённые подключения, выставив в параметре port значение 0 . Задайте порт для TLS‑подключений и раскомментируйте параметр tls-port . В параметре tls-cert-file укажите путь к файлу сертификата сервера. В параметре tls-key-file укажите путь к файлу закрытого ключа. В параметре tls-ca-cert-file укажите путь к файлу корневого CA. port 0 tls-port 6379 tls-cert-file /path/to/valkey.crt tls-key-file /path/to/valkey.key tls-ca-cert-file /path/to/ca.crt Перезапустите все сервера. Начните с master-ноды, а затем перейдите к slave-нодам: sudo systemctl restart valkey-server sudo systemctl enable valkey-server Проверьте статус репликации на ноде valkey-server1.your_domain : sudo valkey-cli -p 6379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key -a SecretPassword info replication Подробнее о настройке TLS/SSL в Valkey читайте в официальной документации Valkey . Шаг 4. Настройка Sentinel Чтобы настроить Sentinel, отредактируйте файл /etc/valkey/sentinel.conf на каждом из серверов. началов внимание Для корректной работы соблюдайте указанный порядок записей в файле /etc/valkey/sentinel.conf . конец внимание Укажите домен (FQDN) для представления нод Sentinel: на ноде valkey-server1.your_domain : sentinel announce-ip valkey-server1.your_domain на ноде valkey-server2.your_domain : sentinel announce-ip valkey-server2.your_domain на ноде valkey-server3.your_domain : sentinel announce-ip valkey-server3.your_domain Настройте домен (FQDN) и порт master-ноды, а также значение для достижения кворума: sentinel monitor mymaster valkey-server1.your_domain 6379 2 Задайте пароль для доступа к master-ноде: sentinel auth-pass mymaster SecretPassword Установите время, после которого master-нода будет считаться вышедшей из строя: sentinel down-after-milliseconds mymaster 3000 Укажите время ожидания после смены ролей slave-ноды на master-ноду, если master-нода вышла из строя: sentinel failover-timeout mymaster 6000 Разрешите использовать имена хостов: sentinel resolve-hostnames yes sentinel announce-hostnames yes Опционально: включите доступ только по паролю для пользователя default : user default on >SecretPassword sanitize-payload ~* &* +@all Перезапустите все сервера: sudo systemctl restart valkey-sentinel sudo systemctl enable valkey-sentinel Проверьте статус Sentinel и состояние кворума на ноде valkey-server1.your_domain : для подключения без TLS/SSL: sudo valkey-cli -p 26379 info sentinel sudo valkey-cli -p 26379 sentinel ckquorum mymaster для подключения без TLS/SSL, если включён доступ только по паролю: sudo valkey-cli -p 26379 -a SecretPassword info sentinel sudo valkey-cli -p 26379 -a SecretPassword sentinel ckquorum mymaster для подключения с TLS/SSL: sudo valkey-cli -p 26379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key info sentinel sudo valkey-cli -p 26379 -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key sentinel ckquorum mymaster для подключения с TLS/SSL, если включён доступ только по паролю: sudo valkey-cli -p 26379 -a SecretPassword -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key info sentinel sudo valkey-cli -p 26379 -a SecretPassword -h valkey-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/valkey.crt --key /path/to/valkey.key sentinel ckquorum mymaster Настройка включения TLS/SSL в Sentinel Чтобы включить поддержку TLS/SSL в Sentinel, в файле конфигурации sentinel.conf : Отключите незащищённые подключения, выставив в параметре port значение 0 . Задайте порт для TLS‑подключений, добавив параметр tls-port . Добавьте параметр tls-cert-file и укажите в нём путь к файлу сертификата сервера. Добавьте параметр tls-key-file и укажите в нём путь к файлу закрытого ключа. Добавьте параметр tls-ca-cert-file и укажите в нём путь к файлу корневого CA. Добавьте параметр tls-replication и включите в нём поддержку TLS, указав значение yes . port 0 tls-port 26379 tls-cert-file /path/to/valkey.crt tls-key-file /path/to/valkey.key tls-ca-cert-file /path/to/ca.crt tls-replication yes Подробнее о настройке TLS/SSL в Sentinel читайте в официальной документации Valkey . Шаг 5. Подключение к Valkey Строка для подключения к Valkey: redis://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster Строка для подключения к Valkey, если включён доступ только по паролю: redis://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster&sentinelUsername=default&sentinelPassword=SecretPassword Строка для подключения к Valkey c TLS/SSL: rediss://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?&masterName=mymaster Строка для подключения к Valkey c TLS/SSL, если включён доступ только по паролю: rediss://:SecretPassword@valkey-server1.your_domain:26379,valkey-server2.your_domain:26379,valkey-server3.your_domain:26379/0?masterName=mymaster&sentinelUsername=default&sentinelPassword=SecretPassword configure-mongodb.html cluster-redis-to-valkey.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/elma365-on-premises.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/infrastructure-preparation.html",
    "https://github.com/valkey-io/valkey/releases",
    "https://repology.org/project/valkey/versions",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/elma365-enterprise-on-premises.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/cluster-redis-to-valkey.html",
    "https://valkey.io/topics/quickstart/",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/valkey-cluster.html",
    "https://valkey.io/topics/encryption/",
    "https://valkey.io/topics/sentinel-clients/",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/configure-mongodb.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T21:50:44.600604",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T21:50:44.643504"
  }
}