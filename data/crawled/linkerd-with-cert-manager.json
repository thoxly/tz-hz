{
  "doc_id": "linkerd-with-cert-manager",
  "url": "https://elma365.com/ru/help/business_solutions/ru/help/platform/linkerd-with-cert-manager.html",
  "title": "Установка Linkerd с помощью Cert-manager",
  "breadcrumbs": [
    "ELMA365 On-Premises",
    "ELMA365 On-Premises Enterprise"
  ],
  "section": "ELMA365 On-Premises > ELMA365 On-Premises Enterprise | [business_solutions]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Установка Linkerd с помощью Cert-manager</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"Linkerd — это выделенный уровень инфраструктуры, который помогает обрабатывать связь между сервисами, автоматически шифровать соединения, обрабатывать повторные запросы и...\" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/platform/linkerd-with-cert-manager.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p><a href=\"elma365-on-premises.html\">ELMA365 On-Premises</a> &gt; <a href=\"elma365-enterprise.html\">ELMA365 On-Premises Enterprise</a> &gt; Установка дополнений для приложения ELMA365 / Установка Linkerd с помощью Cert-manager</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Установка Linkerd с помощью Cert-manager</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p class=\"p_Normal\">Linkerd — это выделенный уровень инфраструктуры, который помогает обрабатывать связь между сервисами, автоматически шифровать соединения, обрабатывать повторные запросы и тайм-ауты. Установка компонента дополнений Linkerd позволяет обеспечить балансировку gRPC-трафика при масштабировании сервисов ELMA365. Также он предоставляет использование телеметрии (коэффициент успешности, задержки) и многое другое.</p>\n<p class=\"p_Normal\">Linkerd является необходимым компонентом для включения поддержки масштабирования сервисов на стороне приложения ELMA365. Без установленного Linkerd масштабирование микросервисов ELMA365 работать не будет.</p>\n<p class=\"p_Normal\">О подготовке сертификатов с помощью openssl для Linkerd и его установке читайте в статье <a class=\"topiclink\" href=\"install-linkerd.html\">«Установка Linkerd»</a>.</p>\n<p class=\"p_Normal\">В этой статье рассмотрим, как:</p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">автоматизировать подготовку сертификатов с помощью инструмента Cert-manager и установить Linkerd;</li></ul>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#delete-chart\">удалить чарт Linkerd с помощью Helm в Kubernetes-кластере</a>.</li></ul>\n<p class=\"p_Normal\">Установка Linkerd состоит из четырёх этапов:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\"><a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#prepare-certificate\">Подготовить сертификаты для Linkerd</a>.</li><li class=\"p_Normal\" value=\"2\"><a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#helm-chart\">Загрузить Helm-чарт и конфигурационный файл</a>.</li><li class=\"p_Normal\" value=\"3\"><a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#configuration-file\">Заполнить конфигурационный файл</a>.</li><li class=\"p_Normal\" value=\"4\"><a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#install-chart\">Установить чарт Linkerd с помощью Helm в Kubernetes-кластер</a>.</li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"prepare-certificate\"></a><span class=\"f_Heading2\">Шаг 1. Подготовить сертификаты для Linkerd</span></h2>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\">Установите <a class=\"topiclink\" href=\"install-cert-manager.html\">Cert-manager</a> и создайте пространства имён. Cert-manager будет использовать их для хранения ресурсов, связанных с веб-перехватчиком:</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">kubectl create namespace linkerd</span><br/>\n<span class=\"f_CodeExample\">kubectl label namespace linkerd linkerd.io/is-control-plane=true config.linkerd.io/admission-webhooks=disabled linkerd.io/control-plane-ns=linkerd</span><br/>\n<span class=\"f_CodeExample\">kubectl annotate namespace linkerd linkerd.io/inject=disabled</span></p>\n<ol start=\"2\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"2\">Установите инструмент <a class=\"weblink\" href=\"https://smallstep.com/cli/\" target=\"_blank\">step</a>, чтобы создать пару ключей для подписи каждого сертификата:</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">wget https://dl.smallstep.com/cli/docs-cli-install/latest/step-cli_amd64.deb</span><br/>\n<span class=\"f_CodeExample\">sudo dpkg -i step-cli_amd64.deb</span></p>\n<ol start=\"3\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"3\">Сгенерируйте сертификаты с помощью <a class=\"weblink\" href=\"https://smallstep.com/cli/\" target=\"_blank\">step</a>, чтобы использовать их для подписи:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\">сертификатов веб-перехватчика;</li></ul>\n<p style=\"line-height: 1.28; margin: 0 0 11px 0;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A1')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Выполните команду</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A1\" style=\"text-align: left; text-indent: 0; line-height: 1.28; padding: 0 0 0 0; margin: 0 0 11px 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">#  Создать ключи CA</span><br/>\n<span class=\"f_CodeExample\">step certificate create webhook.linkerd.cluster.local caWebhook.crt caWebhook.key --profile root-ca --no-password --insecure --san webhook.linkerd.cluster.local --not-after=87600h</span><br/>\n<span class=\"f_CodeExample\">kubectl create secret tls webhook-issuer-tls --cert=caWebhook.crt --key=caWebhook.key --namespace=linkerd</span><br/>\n<span class=\"f_CodeExample\"># Создать Issuer</span><br/>\n<span class=\"f_CodeExample\">kubectl apply -f - &lt;&lt;EOF</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: webhook-issuer</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  ca:</span><br/>\n<span class=\"f_CodeExample\">    secretName: webhook-issuer-tls</span><br/>\n<span class=\"f_CodeExample\">EOF</span><br/>\n<span class=\"f_CodeExample\"># Создать Certificate</span><br/>\n<span class=\"f_CodeExample\">kubectl apply -f - &lt;&lt;EOF</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Certificate</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: linkerd-policy-validator</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  secretName: linkerd-policy-validator-k8s-tls</span><br/>\n<span class=\"f_CodeExample\">  duration: 24h</span><br/>\n<span class=\"f_CodeExample\">  renewBefore: 1h</span><br/>\n<span class=\"f_CodeExample\">  issuerRef:</span><br/>\n<span class=\"f_CodeExample\">    name: webhook-issuer</span><br/>\n<span class=\"f_CodeExample\">    kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">  commonName: linkerd-policy-validator.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  dnsNames:</span><br/>\n<span class=\"f_CodeExample\">  - linkerd-policy-validator.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  isCA: false</span><br/>\n<span class=\"f_CodeExample\">  privateKey:</span><br/>\n<span class=\"f_CodeExample\">    algorithm: ECDSA</span><br/>\n<span class=\"f_CodeExample\">    encoding: PKCS8</span><br/>\n<span class=\"f_CodeExample\">  usages:</span><br/>\n<span class=\"f_CodeExample\">  - server auth</span><br/>\n<span class=\"f_CodeExample\">---</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Certificate</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: linkerd-proxy-injector</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  secretName: linkerd-proxy-injector-k8s-tls</span><br/>\n<span class=\"f_CodeExample\">  duration: 24h</span><br/>\n<span class=\"f_CodeExample\">  renewBefore: 1h</span><br/>\n<span class=\"f_CodeExample\">  issuerRef:</span><br/>\n<span class=\"f_CodeExample\">    name: webhook-issuer</span><br/>\n<span class=\"f_CodeExample\">    kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">  commonName: linkerd-proxy-injector.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  dnsNames:</span><br/>\n<span class=\"f_CodeExample\">  - linkerd-proxy-injector.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  isCA: false</span><br/>\n<span class=\"f_CodeExample\">  privateKey:</span><br/>\n<span class=\"f_CodeExample\">    algorithm: ECDSA</span><br/>\n<span class=\"f_CodeExample\">  usages:</span><br/>\n<span class=\"f_CodeExample\">  - server auth</span><br/>\n<span class=\"f_CodeExample\">---</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Certificate</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: linkerd-sp-validator</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  secretName: linkerd-sp-validator-k8s-tls</span><br/>\n<span class=\"f_CodeExample\">  duration: 24h</span><br/>\n<span class=\"f_CodeExample\">  renewBefore: 1h</span><br/>\n<span class=\"f_CodeExample\">  issuerRef:</span><br/>\n<span class=\"f_CodeExample\">    name: webhook-issuer</span><br/>\n<span class=\"f_CodeExample\">    kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">  commonName: linkerd-sp-validator.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  dnsNames:</span><br/>\n<span class=\"f_CodeExample\">  - linkerd-sp-validator.linkerd.svc</span><br/>\n<span class=\"f_CodeExample\">  isCA: false</span><br/>\n<span class=\"f_CodeExample\">  privateKey:</span><br/>\n<span class=\"f_CodeExample\">    algorithm: ECDSA</span><br/>\n<span class=\"f_CodeExample\">  usages:</span><br/>\n<span class=\"f_CodeExample\">  - server auth</span><br/>\n<span class=\"f_CodeExample\">EOF</span><br/>\n<span class=\"f_CodeExample\"> </span></p>\n</td>\n</tr>\n</table>\n</div>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\">сертификата Control Plane.</li></ul>\n<p style=\"line-height: 1.28; margin: 0 0 11px 0;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A2')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Выполните команду</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A2\" style=\"text-align: left; text-indent: 0; line-height: 1.28; padding: 0 0 0 0; margin: 0 0 11px 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\"># Создать ключи CA</span><br/>\n<span class=\"f_CodeExample\">step certificate create root.linkerd.cluster.local caRoot.crt caRoot.key --profile root-ca --no-password --insecure --not-after=87600h</span><br/>\n<span class=\"f_CodeExample\">kubectl create secret tls linkerd-trust-anchor --cert=caRoot.crt --key=caRoot.key --namespace=linkerd</span><br/>\n<span class=\"f_CodeExample\"># Создать Issuer</span><br/>\n<span class=\"f_CodeExample\">kubectl apply -f - &lt;&lt;EOF</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: linkerd-trust-anchor</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  ca:</span><br/>\n<span class=\"f_CodeExample\">    secretName: linkerd-trust-anchor</span><br/>\n<span class=\"f_CodeExample\">EOF</span><br/>\n<span class=\"f_CodeExample\"># Создать Certificate</span><br/>\n<span class=\"f_CodeExample\">kubectl apply -f - &lt;&lt;EOF</span><br/>\n<span class=\"f_CodeExample\">apiVersion: cert-manager.io/v1</span><br/>\n<span class=\"f_CodeExample\">kind: Certificate</span><br/>\n<span class=\"f_CodeExample\">metadata:</span><br/>\n<span class=\"f_CodeExample\">  name: linkerd-identity-issuer</span><br/>\n<span class=\"f_CodeExample\">  namespace: linkerd</span><br/>\n<span class=\"f_CodeExample\">spec:</span><br/>\n<span class=\"f_CodeExample\">  secretName: linkerd-identity-issuer</span><br/>\n<span class=\"f_CodeExample\">  duration: 48h</span><br/>\n<span class=\"f_CodeExample\">  renewBefore: 25h</span><br/>\n<span class=\"f_CodeExample\">  issuerRef:</span><br/>\n<span class=\"f_CodeExample\">    name: linkerd-trust-anchor</span><br/>\n<span class=\"f_CodeExample\">    kind: Issuer</span><br/>\n<span class=\"f_CodeExample\">  commonName: identity.linkerd.cluster.local</span><br/>\n<span class=\"f_CodeExample\">  dnsNames:</span><br/>\n<span class=\"f_CodeExample\">  - identity.linkerd.cluster.local</span><br/>\n<span class=\"f_CodeExample\">  isCA: true</span><br/>\n<span class=\"f_CodeExample\">  privateKey:</span><br/>\n<span class=\"f_CodeExample\">    algorithm: ECDSA</span><br/>\n<span class=\"f_CodeExample\">  usages:</span><br/>\n<span class=\"f_CodeExample\">  - cert sign</span><br/>\n<span class=\"f_CodeExample\">  - crl sign</span><br/>\n<span class=\"f_CodeExample\">  - server auth</span><br/>\n<span class=\"f_CodeExample\">  - client auth</span><br/>\n<span class=\"f_CodeExample\">EOF</span><br/>\n<span class=\"f_CodeExample\"> </span></p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"helm-chart\"></a><span class=\"f_Heading2\">Шаг 2. Загрузить Helm-чарт и конфигурационный файл</span></h2>\n<p style=\"line-height: 1.28; margin: 0 0 11px 0;\">Для установки через интернет получите конфигурационный файл <code><b>values-linkerd.yaml</b></code>, выполнив команду:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">helm repo add elma365 https://charts.elma365.tech</span><br/>\n<span class=\"f_CodeExample\">helm repo update</span><br/>\n<span class=\"f_CodeExample\">helm show values elma365/linkerd &gt; values-linkerd.yaml</span></p>\n<p class=\"p_Normal\"> </p>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A3')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Получение конфигурационного файла для установки в закрытом контуре без доступа в интернет</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A3\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_Normal\"> </p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\">На компьютере с доступом в интернет загрузите архив актуальной версии (latest) чарта <span style=\"font-weight: bold;\">Linkerd</span> из репозитория ELMA365, выполнив команду:</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">helm repo add elma365 https://charts.elma365.tech</span><br/>\n<span class=\"f_CodeExample\">helm repo update</span><br/>\n<span class=\"f_CodeExample\">helm pull elma365/linkerd</span></p>\n<ol start=\"2\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"2\">Полученный архив чарта <code><b>linkerd-X.Y.Z.tgz</b></code> скопируйте на сервер его установки.</li><li class=\"p_Normal\" value=\"3\">Распакуйте чарт на сервере и скопируйте конфигурационный файл по умолчанию <code><b>values.yaml</b></code> в <code><b>values-linkerd.yaml</b></code>, выполнив команду:</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">tar -xf linkerd-X.Y.Z.tgz</span><br/>\n<span class=\"f_CodeExample\">cp linkerd/values.yaml values-linkerd.yaml</span></p>\n<p class=\"p_Normal\"> </p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"configuration-file\"></a><span class=\"f_Heading2\">Шаг 3. Заполнить конфигурационный файл</span></h2>\n<p class=\"p_Normal\">В конфигурационном файле <code><b>values-linkerd.yaml</b></code> заполните параметры для установки Linkerd:</p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Укажите DNS-имя домена Kubernetes-кластера в параметре <code><b>linkerd.clusterDomain</b></code>. В этом примере указано имя <code><b>cluster.local</b></code>:</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"># Настройки linkerd</span><br/>\n<span class=\"f_CodeExample\">linkerd:</span><br/>\n<span class=\"f_CodeExample\">  # DNS-имя домена Kubernetes</span><br/>\n<span class=\"f_CodeExample\">  clusterDomain: cluster.local</span><br/>\n<span class=\"f_CodeExample\">  # добавляет ресурс PodSecurityPolicy (устарело начиная с версии k8s v1.21)</span><br/>\n<span class=\"f_CodeExample\">  enablePSP: false</span><br/>\n<span class=\"f_CodeExample\">  # отключить heartbeat</span><br/>\n<span class=\"f_CodeExample\">  disableHeartBeat: false  </span><br/>\n<span class=\"f_CodeExample\">...</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Для обеспечения высокой доступности вы можете раскомментировать параметры секции <span style=\"font-weight: bold;\">Параметры для обеспечения высокой доступности</span>.</li></ol>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A4')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Пример включения высокой доступности</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A4\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\"># Настройки linkerd</span><br/>\n<span class=\"f_CodeExample\">linkerd:</span><br/>\n<span class=\"f_CodeExample\">...</span><br/>\n<span class=\"f_CodeExample\">#</span><br/>\n<span class=\"f_CodeExample\"># параметры для обеспечения высокой доступности</span><br/>\n<span class=\"f_CodeExample\">  controllerReplicas: 3</span><br/>\n<span class=\"f_CodeExample\">  enablePodDisruptionBudget: true</span><br/>\n<span class=\"f_CodeExample\">  deploymentStrategy:</span><br/>\n<span class=\"f_CodeExample\">    rollingUpdate:</span><br/>\n<span class=\"f_CodeExample\">      maxUnavailable: 1</span><br/>\n<span class=\"f_CodeExample\">      maxSurge: 25%</span><br/>\n<span class=\"f_CodeExample\">  enablePodAntiAffinity: true</span><br/>\n<span class=\"f_CodeExample\">  proxy:</span><br/>\n<span class=\"f_CodeExample\">    resources:</span><br/>\n<span class=\"f_CodeExample\">      cpu:</span><br/>\n<span class=\"f_CodeExample\">        request: 100m</span><br/>\n<span class=\"f_CodeExample\">      memory:</span><br/>\n<span class=\"f_CodeExample\">        limit: 250Mi</span><br/>\n<span class=\"f_CodeExample\">        request: 20Mi</span><br/>\n<span class=\"f_CodeExample\">  controllerResources: &amp;controller_resources</span><br/>\n<span class=\"f_CodeExample\">    cpu: &amp;controller_resources_cpu</span><br/>\n<span class=\"f_CodeExample\">      limit: \"\"</span><br/>\n<span class=\"f_CodeExample\">      request: 100m</span><br/>\n<span class=\"f_CodeExample\">    memory:</span><br/>\n<span class=\"f_CodeExample\">      limit: 250Mi</span><br/>\n<span class=\"f_CodeExample\">      request: 50Mi</span><br/>\n<span class=\"f_CodeExample\">  destinationResources: *controller_resources</span><br/>\n<span class=\"f_CodeExample\">  identityResources:</span><br/>\n<span class=\"f_CodeExample\">    cpu: *controller_resources_cpu</span><br/>\n<span class=\"f_CodeExample\">    memory:</span><br/>\n<span class=\"f_CodeExample\">      limit: 250Mi</span><br/>\n<span class=\"f_CodeExample\">      request: 10Mi</span><br/>\n<span class=\"f_CodeExample\">  heartbeatResources: *controller_resources</span><br/>\n<span class=\"f_CodeExample\">  proxyInjectorResources: *controller_resources</span><br/>\n<span class=\"f_CodeExample\">  webhookFailurePolicy: Ignore</span><br/>\n<span class=\"f_CodeExample\">  spValidatorResources: *controller_resources</span><br/>\n<span class=\"f_CodeExample\"># </span><br/>\n<span class=\"f_CodeExample\">...</span></p>\n<p class=\"p_Normal\"> </p>\n</td>\n</tr>\n</table>\n</div>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"3\">Если вы установили <a class=\"topiclink\" href=\"install-monitoring-tools.html\">средства мониторинга</a>, укажите параметр для сбора метрик Linkerd:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\"># Параметр подключения сбора метрик</span><br/>\n<span class=\"f_CodeExample\">podMonitor:</span><br/>\n<span class=\"f_CodeExample\">  enabled: true</span></p>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"4\">Если вы устанавливаете Linkerd в закрытом контуре без доступа в интернет, заполните параметры подключения к приватному <span style=\"font-weight: bold;\">registry</span>.</li></ol>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A5')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Пример заполнения параметров для подключения к приватному registry</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A5\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_Normal\"> <br/>\nДля подключения к приватному <code><b>registry</b></code>:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\">Скачайте образы ELMA365 и загрузите их в локальный реестр образов. Подробнее об этом читайте в статье <a class=\"topiclink\" href=\"downloadin-images-elma365.html\">«Загрузка образов ELMA365»</a>.</li><li class=\"p_Normal\" value=\"2\">Задайте адрес и путь в параметрах <code><b>linkerd.controllerImage</b></code>, <code><b>linkerd.policyController.image.name</b></code>, <code><b>linkerd.proxy.image.name</b></code>, <code><b>linkerd.proxyInit.image.name</b></code>.</li><li class=\"p_Normal\" value=\"3\">Укажите наименование секрета с правами доступа к приватному <code><b>registry</b></code> в параметре <code><b>linkerd.imagePullSecrets</b></code>. Секрет должен быть создан вручную и зашифрован в Base64.</li></ol>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"># Настройки linkerd</span><br/>\n<span class=\"f_CodeExample\">linkerd:</span><br/>\n<span class=\"f_CodeExample\">...</span><br/>\n<span class=\"f_CodeExample\">  # параметры подключения к приватному registry</span><br/>\n<span class=\"f_CodeExample\">  # адрес и путь для приватного registry</span><br/>\n<span class=\"f_CodeExample\">  controllerImage: registry.example.com/linkerd/controller</span><br/>\n<span class=\"f_CodeExample\">  policyController:</span><br/>\n<span class=\"f_CodeExample\">    image:</span><br/>\n<span class=\"f_CodeExample\">      # адрес и путь для приватного registry</span><br/>\n<span class=\"f_CodeExample\">      name: registry.example.com/linkerd/policy-controller</span><br/>\n<span class=\"f_CodeExample\">  proxy:</span><br/>\n<span class=\"f_CodeExample\">    image:</span><br/>\n<span class=\"f_CodeExample\">      # адрес и путь для приватного registry</span><br/>\n<span class=\"f_CodeExample\">      name: registry.example.com/linkerd/proxy</span><br/>\n<span class=\"f_CodeExample\">  proxyInit:</span><br/>\n<span class=\"f_CodeExample\">    image:</span><br/>\n<span class=\"f_CodeExample\">      # адрес и путь для приватного registry</span><br/>\n<span class=\"f_CodeExample\">      name: registry.example.com/linkerd/proxy-init</span><br/>\n<span class=\"f_CodeExample\">  # секрет с правами доступа к приватному registry должен быть создан вручную и зашифрован в Base64</span><br/>\n<span class=\"f_CodeExample\">  imagePullSecrets:</span><br/>\n<span class=\"f_CodeExample\">    - name: myRegistryKeySecretName</span></p>\n<p class=\"p_Normal\">Где формат:</p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><code><b>linkerd.controllerImage</b></code>:</li></ul>\n<ul style=\"list-style-type:circle\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">адрес — <code><b>registry.example.com</b></code>;</li><li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">путь — <code><b>/linkerd/controller</b></code>;</li></ul>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><code><b>linkerd.policyController.image.name</b></code>:</li></ul>\n<ul style=\"list-style-type:circle\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">адрес — <code><b>registry.example.com</b></code>;</li><li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">путь — <code><b>/linkerd/policy-controller</b></code>;</li></ul>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><code><b>linkerd.proxy.image.name</b></code>:</li></ul>\n<ul style=\"list-style-type:circle\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">адрес — <code><b>registry.example.com</b></code>;</li><li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">путь — <code><b>/linkerd/proxy</b></code>;</li></ul>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><code><b>linkerd.proxyInit.image.name</b></code>:</li></ul>\n<ul style=\"list-style-type:circle\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">адрес — <code><b>registry.example.com</b></code>;</li><li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\">путь — <code><b>/linkerd/proxy-init</b></code>.</li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\"> </span></p>\n<p class=\"p_Normal\"> </p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"install-chart\"></a><span class=\"f_Heading2\">Шаг 4. Установить чарт Linkerd с помощью Helm в Kubernetes-кластер</span></h2>\n<p class=\"p_Normal\">Установите чарт <span style=\"font-weight: bold;\">Linkerd</span> в <code><b>namespace linkerd</b></code>. Namespace будет создан во время установки, если не был создан ранее.</p>\n<p class=\"p_Normal\">В примере ниже команда установки выполняется из директории, где на <a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#prepare-certificate\">шаге 1</a> были созданы сертификаты. Если выполнение команды происходит из другой директории, укажите пути до сертификатов, созданных на <a class=\"topiclink\" href=\"linkerd-with-cert-manager.html#prepare-certificate\">шаге 1</a> (<code><b>caRoot.crt</b></code>, <code><b>caWebhook.crt</b></code>).</p>\n<p class=\"p_Normal\">Для установки через интернет:</p>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">helm upgrade --install linkerd elma365/linkerd -f values-linkerd.yaml -n linkerd --create-namespace \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.identityTrustAnchorsPEM=caRoot.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.identity.issuer.scheme=kubernetes.io/tls \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.policyValidator.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.policyValidator.caBundle=caWebhook.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.proxyInjector.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.proxyInjector.caBundle=caWebhook.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.profileValidator.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.profileValidator.caBundle=caWebhook.crt</span></p>\n<p class=\"p_Normal\">Для установки без доступа в интернет:</p>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">helm upgrade --install linkerd ./linkerd -f values-linkerd.yaml -n linkerd --create-namespace \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.identityTrustAnchorsPEM=caRoot.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.identity.issuer.scheme=kubernetes.io/tls \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.policyValidator.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.policyValidator.caBundle=caWebhook.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.proxyInjector.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.proxyInjector.caBundle=caWebhook.crt \\</span><br/>\n<span class=\"f_CodeExample\">--set linkerd.profileValidator.externalSecret=true \\</span><br/>\n<span class=\"f_CodeExample\">--set-file linkerd.profileValidator.caBundle=caWebhook.crt</span></p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Начало внимание</span></p>\n<p class=\"p_Normal\">После установки Linkerd измените параметры приложения ELMA365 и настройте автомасштабирование сервисов. Подробнее читайте в статье <a class=\"topiclink\" href=\"autoscaling-service-enterprise.html\">«Включение автомасштабирования сервисов в ELMA365 Enterprise»</a>.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Конец внимание</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"delete-chart\"></a><span class=\"f_Heading2\">Удалить чарт Linkerd с помощью Helm в Kubernetes-кластере</span></h2>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Начало внимание</span></p>\n<p class=\"p_Normal\">Перед удалением компонента дополнений Linkerd отключите автомасштабирование на стороне приложения ELMA365.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Конец внимание</span></p>\n<p class=\"p_Normal\">Чтобы удалить чарт <span style=\"font-weight: bold;\">Linkerd</span> в <code><b>namespace linkerd</b></code>, выполните команду:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">helm uninstall linkerd -n linkerd</span></p>\n<p class=\"p_Normal\"> </p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"install-linkerd.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">install-linkerd.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"install-hostpath-provisioner.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">install-hostpath-provisioner.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n<script type=\"text/javascript\">\nHMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A2','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A3','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A4','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A5','hm.type','dropdown','hm.state','0');\n</script>\n</body>\n</html>\n",
  "plain_text": "Установка Linkerd с помощью Cert-manager ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 ELMA365 On-Premises > ELMA365 On-Premises Enterprise > Установка дополнений для приложения ELMA365 / Установка Linkerd с помощью Cert-manager Установка Linkerd с помощью Cert-manager Linkerd — это выделенный уровень инфраструктуры, который помогает обрабатывать связь между сервисами, автоматически шифровать соединения, обрабатывать повторные запросы и тайм-ауты. Установка компонента дополнений Linkerd позволяет обеспечить балансировку gRPC-трафика при масштабировании сервисов ELMA365. Также он предоставляет использование телеметрии (коэффициент успешности, задержки) и многое другое. Linkerd является необходимым компонентом для включения поддержки масштабирования сервисов на стороне приложения ELMA365. Без установленного Linkerd масштабирование микросервисов ELMA365 работать не будет. О подготовке сертификатов с помощью openssl для Linkerd и его установке читайте в статье «Установка Linkerd» . В этой статье рассмотрим, как: автоматизировать подготовку сертификатов с помощью инструмента Cert-manager и установить Linkerd; удалить чарт Linkerd с помощью Helm в Kubernetes-кластере . Установка Linkerd состоит из четырёх этапов: Подготовить сертификаты для Linkerd . Загрузить Helm-чарт и конфигурационный файл . Заполнить конфигурационный файл . Установить чарт Linkerd с помощью Helm в Kubernetes-кластер . Шаг 1. Подготовить сертификаты для Linkerd Установите Cert-manager и создайте пространства имён. Cert-manager будет использовать их для хранения ресурсов, связанных с веб-перехватчиком: kubectl create namespace linkerd kubectl label namespace linkerd linkerd.io/is-control-plane=true config.linkerd.io/admission-webhooks=disabled linkerd.io/control-plane-ns=linkerd kubectl annotate namespace linkerd linkerd.io/inject=disabled Установите инструмент step , чтобы создать пару ключей для подписи каждого сертификата: wget https://dl.smallstep.com/cli/docs-cli-install/latest/step-cli_amd64.deb sudo dpkg -i step-cli_amd64.deb Сгенерируйте сертификаты с помощью step , чтобы использовать их для подписи: сертификатов веб-перехватчика; Выполните команду # Создать ключи CA step certificate create webhook.linkerd.cluster.local caWebhook.crt caWebhook.key --profile root-ca --no-password --insecure --san webhook.linkerd.cluster.local --not-after=87600h kubectl create secret tls webhook-issuer-tls --cert=caWebhook.crt --key=caWebhook.key --namespace=linkerd # Создать Issuer kubectl apply -f - <<EOF apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: webhook-issuer namespace: linkerd spec: ca: secretName: webhook-issuer-tls EOF # Создать Certificate kubectl apply -f - <<EOF apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: linkerd-policy-validator namespace: linkerd spec: secretName: linkerd-policy-validator-k8s-tls duration: 24h renewBefore: 1h issuerRef: name: webhook-issuer kind: Issuer commonName: linkerd-policy-validator.linkerd.svc dnsNames: - linkerd-policy-validator.linkerd.svc isCA: false privateKey: algorithm: ECDSA encoding: PKCS8 usages: - server auth --- apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: linkerd-proxy-injector namespace: linkerd spec: secretName: linkerd-proxy-injector-k8s-tls duration: 24h renewBefore: 1h issuerRef: name: webhook-issuer kind: Issuer commonName: linkerd-proxy-injector.linkerd.svc dnsNames: - linkerd-proxy-injector.linkerd.svc isCA: false privateKey: algorithm: ECDSA usages: - server auth --- apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: linkerd-sp-validator namespace: linkerd spec: secretName: linkerd-sp-validator-k8s-tls duration: 24h renewBefore: 1h issuerRef: name: webhook-issuer kind: Issuer commonName: linkerd-sp-validator.linkerd.svc dnsNames: - linkerd-sp-validator.linkerd.svc isCA: false privateKey: algorithm: ECDSA usages: - server auth EOF сертификата Control Plane. Выполните команду # Создать ключи CA step certificate create root.linkerd.cluster.local caRoot.crt caRoot.key --profile root-ca --no-password --insecure --not-after=87600h kubectl create secret tls linkerd-trust-anchor --cert=caRoot.crt --key=caRoot.key --namespace=linkerd # Создать Issuer kubectl apply -f - <<EOF apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: linkerd-trust-anchor namespace: linkerd spec: ca: secretName: linkerd-trust-anchor EOF # Создать Certificate kubectl apply -f - <<EOF apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: linkerd-identity-issuer namespace: linkerd spec: secretName: linkerd-identity-issuer duration: 48h renewBefore: 25h issuerRef: name: linkerd-trust-anchor kind: Issuer commonName: identity.linkerd.cluster.local dnsNames: - identity.linkerd.cluster.local isCA: true privateKey: algorithm: ECDSA usages: - cert sign - crl sign - server auth - client auth EOF Шаг 2. Загрузить Helm-чарт и конфигурационный файл Для установки через интернет получите конфигурационный файл values-linkerd.yaml , выполнив команду: helm repo add elma365 https://charts.elma365.tech helm repo update helm show values elma365/linkerd > values-linkerd.yaml Получение конфигурационного файла для установки в закрытом контуре без доступа в интернет На компьютере с доступом в интернет загрузите архив актуальной версии (latest) чарта Linkerd из репозитория ELMA365, выполнив команду: helm repo add elma365 https://charts.elma365.tech helm repo update helm pull elma365/linkerd Полученный архив чарта linkerd-X.Y.Z.tgz скопируйте на сервер его установки. Распакуйте чарт на сервере и скопируйте конфигурационный файл по умолчанию values.yaml в values-linkerd.yaml , выполнив команду: tar -xf linkerd-X.Y.Z.tgz cp linkerd/values.yaml values-linkerd.yaml Шаг 3. Заполнить конфигурационный файл В конфигурационном файле values-linkerd.yaml заполните параметры для установки Linkerd: Укажите DNS-имя домена Kubernetes-кластера в параметре linkerd.clusterDomain . В этом примере указано имя cluster.local : # Настройки linkerd linkerd: # DNS-имя домена Kubernetes clusterDomain: cluster.local # добавляет ресурс PodSecurityPolicy (устарело начиная с версии k8s v1.21) enablePSP: false # отключить heartbeat disableHeartBeat: false ... Для обеспечения высокой доступности вы можете раскомментировать параметры секции Параметры для обеспечения высокой доступности . Пример включения высокой доступности # Настройки linkerd linkerd: ... # # параметры для обеспечения высокой доступности controllerReplicas: 3 enablePodDisruptionBudget: true deploymentStrategy: rollingUpdate: maxUnavailable: 1 maxSurge: 25% enablePodAntiAffinity: true proxy: resources: cpu: request: 100m memory: limit: 250Mi request: 20Mi controllerResources: &controller_resources cpu: &controller_resources_cpu limit: \"\" request: 100m memory: limit: 250Mi request: 50Mi destinationResources: *controller_resources identityResources: cpu: *controller_resources_cpu memory: limit: 250Mi request: 10Mi heartbeatResources: *controller_resources proxyInjectorResources: *controller_resources webhookFailurePolicy: Ignore spValidatorResources: *controller_resources # ... Если вы установили средства мониторинга , укажите параметр для сбора метрик Linkerd: # Параметр подключения сбора метрик podMonitor: enabled: true Если вы устанавливаете Linkerd в закрытом контуре без доступа в интернет, заполните параметры подключения к приватному registry . Пример заполнения параметров для подключения к приватному registry Для подключения к приватному registry : Скачайте образы ELMA365 и загрузите их в локальный реестр образов. Подробнее об этом читайте в статье «Загрузка образов ELMA365» . Задайте адрес и путь в параметрах linkerd.controllerImage , linkerd.policyController.image.name , linkerd.proxy.image.name , linkerd.proxyInit.image.name . Укажите наименование секрета с правами доступа к приватному registry в параметре linkerd.imagePullSecrets . Секрет должен быть создан вручную и зашифрован в Base64. # Настройки linkerd linkerd: ... # параметры подключения к приватному registry # адрес и путь для приватного registry controllerImage: registry.example.com/linkerd/controller policyController: image: # адрес и путь для приватного registry name: registry.example.com/linkerd/policy-controller proxy: image: # адрес и путь для приватного registry name: registry.example.com/linkerd/proxy proxyInit: image: # адрес и путь для приватного registry name: registry.example.com/linkerd/proxy-init # секрет с правами доступа к приватному registry должен быть создан вручную и зашифрован в Base64 imagePullSecrets: - name: myRegistryKeySecretName Где формат: linkerd.controllerImage : адрес — registry.example.com ; путь — /linkerd/controller ; linkerd.policyController.image.name : адрес — registry.example.com ; путь — /linkerd/policy-controller ; linkerd.proxy.image.name : адрес — registry.example.com ; путь — /linkerd/proxy ; linkerd.proxyInit.image.name : адрес — registry.example.com ; путь — /linkerd/proxy-init . Шаг 4. Установить чарт Linkerd с помощью Helm в Kubernetes-кластер Установите чарт Linkerd в namespace linkerd . Namespace будет создан во время установки, если не был создан ранее. В примере ниже команда установки выполняется из директории, где на шаге 1 были созданы сертификаты. Если выполнение команды происходит из другой директории, укажите пути до сертификатов, созданных на шаге 1 ( caRoot.crt , caWebhook.crt ). Для установки через интернет: helm upgrade --install linkerd elma365/linkerd -f values-linkerd.yaml -n linkerd --create-namespace \\ --set-file linkerd.identityTrustAnchorsPEM=caRoot.crt \\ --set linkerd.identity.issuer.scheme=kubernetes.io/tls \\ --set linkerd.policyValidator.externalSecret=true \\ --set-file linkerd.policyValidator.caBundle=caWebhook.crt \\ --set linkerd.proxyInjector.externalSecret=true \\ --set-file linkerd.proxyInjector.caBundle=caWebhook.crt \\ --set linkerd.profileValidator.externalSecret=true \\ --set-file linkerd.profileValidator.caBundle=caWebhook.crt Для установки без доступа в интернет: helm upgrade --install linkerd ./linkerd -f values-linkerd.yaml -n linkerd --create-namespace \\ --set-file linkerd.identityTrustAnchorsPEM=caRoot.crt \\ --set linkerd.identity.issuer.scheme=kubernetes.io/tls \\ --set linkerd.policyValidator.externalSecret=true \\ --set-file linkerd.policyValidator.caBundle=caWebhook.crt \\ --set linkerd.proxyInjector.externalSecret=true \\ --set-file linkerd.proxyInjector.caBundle=caWebhook.crt \\ --set linkerd.profileValidator.externalSecret=true \\ --set-file linkerd.profileValidator.caBundle=caWebhook.crt Начало внимание После установки Linkerd измените параметры приложения ELMA365 и настройте автомасштабирование сервисов. Подробнее читайте в статье «Включение автомасштабирования сервисов в ELMA365 Enterprise» . Конец внимание Удалить чарт Linkerd с помощью Helm в Kubernetes-кластере Начало внимание Перед удалением компонента дополнений Linkerd отключите автомасштабирование на стороне приложения ELMA365. Конец внимание Чтобы удалить чарт Linkerd в namespace linkerd , выполните команду: helm uninstall linkerd -n linkerd install-linkerd.html install-hostpath-provisioner.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/elma365-on-premises.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/elma365-enterprise.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/install-linkerd.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/linkerd-with-cert-manager.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/install-cert-manager.html",
    "https://smallstep.com/cli/",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/install-monitoring-tools.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/downloadin-images-elma365.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/autoscaling-service-enterprise.html",
    "https://elma365.com/ru/help/business_solutions/ru/help/platform/install-hostpath-provisioner.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T21:50:50.232960",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T21:50:50.272707"
  }
}