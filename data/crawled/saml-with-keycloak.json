{
  "doc_id": "saml-with-keycloak",
  "url": "https://elma365.com/ru/help/crm/ /ru/help/platform/saml-with-keycloak.html",
  "title": "Настройка SAML-интеграции с Keycloak",
  "breadcrumbs": [],
  "section": "[crm]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Настройка SAML-интеграции с Keycloak</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"SAML‑интеграция позволяет использовать Keycloak для аутентификации и автоматического создания внутренних и внешних пользователей в ELMA365. \" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/business_solutions/saml-with-keycloak.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p>Интеграция с SAML / Настройка SAML-интеграции с Keycloak</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Настройка SAML-интеграции с Keycloak</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p class=\"p_Normal\">SAML‑интеграция позволяет использовать Keycloak для аутентификации и автоматического создания внутренних и внешних пользователей в ELMA365. </p>\n<p class=\"p_Normal\">В момент авторизации в ELMA365 будет создаваться новый внутренний пользователь, а запись о нём появится в справочнике <a class=\"topiclink\" href=\"360004833572.html\">Пользователи</a>. Если авторизация происходит на портале, то запись о пользователе появится в системном справочнике <a class=\"topiclink\" href=\"external-users.html\">Внешние пользователи</a>. </p>\n<p class=\"p_Normal\">Обратите внимание, чтобы незарегистрированный пользователь вошёл на портал через SAML, ему не нужно высылать <a class=\"topiclink\" href=\"add-external-users.html#get_link\">индивидуальную ссылку-приглашение</a>. Достаточно предоставить ему ссылку на страницу портала.</p>\n<p class=\"p_Normal\">Перед началом настройки интеграции выполните установку Keycloak согласно <a class=\"weblink\" href=\"https://www.keycloak.org/guides\" target=\"_blank\">официальной документации</a>. </p>\n<p class=\"p_Normal\">Для корректной работы требуется шифрованное соединение с сертификатами tls на серверах Keycloak и ELMA365. </p>\n<h2 class=\"p_Heading2\"><span class=\"f_Heading2\">Первоначальная настройка приложения SAML в Keycloak </span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Откройте настройки Keycloak по адресу http://my_domen.com:8443, где: <ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">my_domen.com</span> — адрес вашего сайта; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">:8443</span> — стандартный порт, используемый Keycloak при шифрованном соединении. Его можно изменить при конфигурировании рабочей среды. </li></ul>\n</li><li class=\"p_Normal\" value=\"2\">Перейдите в <span style=\"font-weight: bold;\">Administration Console</span>. Для подтверждения действия введите логин и пароль от своей учётной записи. </li><li class=\"p_Normal\" value=\"3\">На открывшейся странице создайте новое окружение. Введите название окружения и нажмите кнопку <span style=\"font-weight: bold;\">Create</span>. </li><li class=\"p_Normal\" value=\"4\">Из левого меню перейдите в раздел <span style=\"font-weight: bold;\">Realm setting</span>. На вкладке <span style=\"font-weight: bold;\">General</span> из поля <span style=\"font-weight: bold;\">Endpoints</span> скопируйте ссылку на метаданные Keycloak для интеграции с SAML. </li></ol>\n<h2 class=\"p_Heading2\"><span class=\"f_Heading2\">Настройка интеграции с SAML в ELMA365 </span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Перейдите в <span style=\"font-weight: bold;\">Администрирование &gt; Модули &gt; SAML</span>. </li><li class=\"p_Normal\" value=\"2\">Поставьте флажок напротив опции <span style=\"font-weight: bold;\">Включить модуль</span> и нажмите <span style=\"font-weight: bold;\">Добавить элемент</span>. </li><li class=\"p_Normal\" value=\"3\">В открывшемся окне настроек провайдера заполните поля: </li></ol>\n<p class=\"p_Normal\" style=\"margin: 0 0 0 36px;\"><img alt=\"saml\" height=\"757\" src=\"saml.png\" style=\"margin:0;width:524px;height:757px;border:none\" width=\"524\"/></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">Наименование</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — название для интеграции; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">URL метаданных IdP</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — URL метаданных вашего Keycloak сервера, который был получен при первоначальной настройке приложения SAML в Keycloak на шаге 4; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">Публичный ключ</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — строковое представление вашего публичного ключа в <span style=\"font-weight: bold;\">.pem</span> формате:  </li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">-----BEGIN CERTIFICATE-----</span><br/>\n<span class=\"f_CodeExample\">…</span><br/>\n<span class=\"f_CodeExample\">-----END CERTIFICATE-----</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">Закрытый ключ</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — строковое представление вашего закрытого ключа в <span style=\"font-weight: bold;\">.pem</span> формате: </li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">-----BEGIN PRIVATE KEY-----</span><br/>\n<span class=\"f_CodeExample\">…</span><br/>\n<span class=\"f_CodeExample\">-----END PRIVATE KEY-----</span></p>\n<p class=\"p_Normal\">Для генерации публичного ключа и закрытого ключа используйте следующую команду в openssl: </p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">openssl req -x509 -newkey rsa:2048 -keyout service.key -out service.cert -days 365 -nodes -subj \"/CN=mydomain.pro\"</span></p>\n<p class=\"p_Normal\">Где <span style=\"font-weight: bold;\">mydomain.pro</span> — ваше доменное имя keycloak. </p>\n<p class=\"p_Normal\">Для последующей настройки интеграции вам потребуется импортировать публичный ключ в формате <span style=\"font-weight: bold;\">PKCS12</span>. Для его экспорта используйте следующую команду: </p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">openssl pkcs12 -export -out cert.p12 -in service.cert -inkey service.key -name learn </span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">Создавать пользователей в момент авторизации</span> — установите параметр в значение <span style=\"font-weight: bold;\">Да</span>, чтобы отсутствующие внешние или внутренние пользователи создавались автоматически при попытке авторизации пользователя в системе; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">Преобразовывать существующих пользователей</span> — установите параметр в значение <span style=\"font-weight: bold;\">Да</span>, если необходимо обновлять существующих пользователей в момент авторизации. При обновлении пользователь будет преобразован во внешнего SAML‑пользователя, при этом у него пропадёт возможность авторизации прежним способом;</li><li class=\"p_Normal\"><a class=\"hmanchor\" id=\"update-user-data\"></a><span style=\"font-family: Inter; font-weight: bold;\">Обновлять данные существующих пользователей </span><span style=\"font-family: Inter;\">— установите параметр в значение </span><span style=\"font-family: Inter; font-weight: bold;\">Да</span><span style=\"font-family: Inter;\">, чтобы в момент аутентификации пользователя его данные в ELMA365 обновлялись на данные, полученные в SAML‑сообщении. Набор данных, которые отправляются в SAML‑сообщении, определяется при </span><span style=\"font-family: Inter; color: #0000ff;\"><a class=\"topiclink\" href=\"saml-with-keycloak.html#add-parameters\">создании параметров на стороне провайдера аутентификации</a></span><span style=\"font-family: Inter;\">. Обратите внимание, если в SAML‑сообщении получены пустые значения, они также заменяют существующие данные пользователя в ELMA365;</span></li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">Использовать для пользователей</span> — укажите, для кого будет возможна авторизация через SAML: для пользователей внешнего портала или для внутренних пользователей ELMA365.</li></ul>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"4\">Нажмите <span style=\"font-weight: bold;\">Сохранить</span>. После этого будет сгенерирована ссылка на файл метаданных, которая отобразится в поле <span style=\"font-weight: bold;\">URL метаданных</span>. </li><li class=\"p_Normal\" value=\"5\">Перейдите по полученной ссылке и сохраните файл метаданных Service Provider в <span style=\"font-weight: bold;\">.xml</span> формате. Он потребуется для финальной настройки SAML‑приложения на стороне Keycloak. </li></ol>\n<h2 class=\"p_Heading2\"><span class=\"f_Heading2\">Финальная настройка приложения SAML в Keycloak </span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Вернитесь в интерфейс настройки Keycloak и импортируйте клиента с помощью файла метаданных, полученных при настройке интеграции SAML в ELMA365 на шаге 5. Для этого из левого меню перейдите в раздел <span style=\"font-weight: bold;\">Clients</span> и нажмите кнопку <span style=\"font-weight: bold;\">Import client</span>. На отрывшейся странице загрузите файл метаданных с помощью кнопки <span style=\"font-weight: bold;\">Browse</span>. После сохранения откроется окно настройки приложения. </li><li class=\"p_Normal\" value=\"2\">Перейдите на вкладку <span style=\"font-weight: bold;\">Keys</span> и с помощью кнопки <span style=\"font-weight: bold;\">Import Key</span> импортируйте хранилище ключей <span style=\"font-weight: bold;\">cert.p12</span>, созданное при настройке интеграции SAML в ELMA365 на шаге 3. Укажите формат архивирования (в нашем примере это <span style=\"font-weight: bold;\">PKCS12</span>), лэйбл, указанный после директивы <span style=\"font-weight: bold;\">-name</span> при экспорте ключа, и пароль от хранилища.  </li><li class=\"p_Normal\" value=\"3\"><a class=\"hmanchor\" id=\"add-parameters\"></a>Для корректной работы интеграции на стороне Keycloak необходимо создать два обязательных для SAML‑параметра: <span style=\"font-weight: bold;\">windowsaccountname</span> и <span style=\"font-weight: bold;\">externalCode</span>. <span style=\"font-family: Inter;\">Если в настройках модуля </span><span style=\"font-family: Inter; font-weight: bold;\">SAML</span><span style=\"font-family: Inter;\"> в ELMA365 включено </span><span style=\"font-family: Inter; color: #0000ff;\"><a class=\"topiclink\" href=\"saml-with-keycloak.html#update-user-data\">обновление данных пользователей при аутентификации</a></span><span style=\"font-family: Inter;\">, добавленные параметры также определяют, какие данные будут обновляться.</span></li></ol>\n<p style=\"line-height: 1.28; margin: 0 0 11px 34px;\"><span style=\"font-family: Inter;\">Для добавления параметров перейдите из левого меню</span> в раздел <span style=\"font-weight: bold;\">Clients</span> и выберите созданное приложение. Затем откройте вкладку <span style=\"font-weight: bold;\">Client scopes</span> и снова выберите созданное приложение. </p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"4\">На открывшейся странице на вкладке <span style=\"font-weight: bold;\">Mappers</span> нажмите кнопку <span style=\"font-weight: bold;\">Add predefined mapper</span>. Из открывшегося списка выберите <span style=\"font-weight: bold;\">role_list</span>.</li><li class=\"p_Normal\" value=\"5\">На вкладке <span style=\"font-weight: bold;\">Mappers</span> нажмите кнопку <span style=\"font-weight: bold;\">Add mapper</span>. Из списка выберите <span style=\"font-weight: bold;\">By configuration</span>. В открывшемся модальном окне выберите <span style=\"font-weight: bold;\">User attributes</span>. </li><li class=\"p_Normal\" value=\"6\">Создайте два параметра со следующими данными: </li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">для windowsaccountname</span>: <ul style=\"list-style-type:circle\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">Name</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/windowsaccountname;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">User Attribute</span> — windowsaccountname; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">SAML Attribute Name</span> — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/windowsaccountname;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">SAML Attribute NameFormat</span> — URL Reference. </li></ul></li></ul>\n<p class=\"p_Normal\" style=\"margin: 0 0 0 36px;\">Параметр является обязательным. Атрибут будет сопоставлен с логином пользователя в ELMA365. </p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">для <span style=\"font-weight: bold;\">externalCode</span>: </li></ul>\n<ul style=\"list-style-type:disc\"><ul style=\"list-style-type:circle\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">Name</span><span style=\"font-weight: bold; color: #ff0000;\">*</span> — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/externalCode;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">User Attribute</span> — externalCode; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">SAML Attribute Name</span> — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/externalCode;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">SAML Attribute NameFormat</span> — URL Reference. </li></ul></ul>\n<p class=\"p_Normal\" style=\"margin: 0 0 0 36px;\">Параметр является обязательным. Используется для идентификации внешнего пользователя в ELMA365. </p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"7\">Так как Keycloak будет являться поставщиком удостоверений, необходимо создать нового пользователя. Для этого из левого меню перейдите в раздел <span style=\"font-weight: bold;\">Users</span> и создайте пользователя. Затем откройте вкладку <span style=\"font-weight: bold;\">Credentials</span> и задайте для него пароль. </li><li class=\"p_Normal\" value=\"8\">На вкладке <span style=\"font-weight: bold;\">Attributes</span> укажите значения для следующих атрибутов:  </li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">externalCode</span> — идентификатор пользователя, аналог objectGUID в ActiveDirectory; </li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">windowsaccountname</span> — логин пользователя из интерфейса ELMA365. </li></ul>\n<p class=\"p_Normal\" style=\"margin: 0 0 0 36px;\">Также укажите электронную почту и имя пользователя.  </p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"9\">Нажмите <span style=\"font-weight: bold;\">Save</span>. </li></ol>\n<h2 class=\"p_Heading2\"><span class=\"f_Heading2\">Удаление SAML-провайдера</span></h2>\n<p class=\"p_Normal\">Если в системе нет пользователей, авторизованных через SAML-провайдера, его можно удалить. Для этого в настройках модуля SAML нажмите на значок корзины справа от названия и подтвердите действие.</p>\n<p class=\"p_Normal\"><img alt=\"saml-4\" height=\"312\" src=\"saml-4.png\" style=\"margin:0;width:603px;height:312px;border:none\" width=\"603\"/></p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"saml-with-azure.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">saml-with-azure.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"audit_service.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">audit_service.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n</body>\n</html>\n",
  "plain_text": "Настройка SAML-интеграции с Keycloak ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 Интеграция с SAML / Настройка SAML-интеграции с Keycloak Настройка SAML-интеграции с Keycloak SAML‑интеграция позволяет использовать Keycloak для аутентификации и автоматического создания внутренних и внешних пользователей в ELMA365. В момент авторизации в ELMA365 будет создаваться новый внутренний пользователь, а запись о нём появится в справочнике Пользователи . Если авторизация происходит на портале, то запись о пользователе появится в системном справочнике Внешние пользователи . Обратите внимание, чтобы незарегистрированный пользователь вошёл на портал через SAML, ему не нужно высылать индивидуальную ссылку-приглашение . Достаточно предоставить ему ссылку на страницу портала. Перед началом настройки интеграции выполните установку Keycloak согласно официальной документации . Для корректной работы требуется шифрованное соединение с сертификатами tls на серверах Keycloak и ELMA365. Первоначальная настройка приложения SAML в Keycloak Откройте настройки Keycloak по адресу http://my_domen.com:8443, где: my_domen.com — адрес вашего сайта; :8443 — стандартный порт, используемый Keycloak при шифрованном соединении. Его можно изменить при конфигурировании рабочей среды. Перейдите в Administration Console . Для подтверждения действия введите логин и пароль от своей учётной записи. На открывшейся странице создайте новое окружение. Введите название окружения и нажмите кнопку Create . Из левого меню перейдите в раздел Realm setting . На вкладке General из поля Endpoints скопируйте ссылку на метаданные Keycloak для интеграции с SAML. Настройка интеграции с SAML в ELMA365 Перейдите в Администрирование > Модули > SAML . Поставьте флажок напротив опции Включить модуль и нажмите Добавить элемент . В открывшемся окне настроек провайдера заполните поля: Наименование * — название для интеграции; URL метаданных IdP * — URL метаданных вашего Keycloak сервера, который был получен при первоначальной настройке приложения SAML в Keycloak на шаге 4; Публичный ключ * — строковое представление вашего публичного ключа в .pem формате: -----BEGIN CERTIFICATE----- … -----END CERTIFICATE----- Закрытый ключ * — строковое представление вашего закрытого ключа в .pem формате: -----BEGIN PRIVATE KEY----- … -----END PRIVATE KEY----- Для генерации публичного ключа и закрытого ключа используйте следующую команду в openssl: openssl req -x509 -newkey rsa:2048 -keyout service.key -out service.cert -days 365 -nodes -subj \"/CN=mydomain.pro\" Где mydomain.pro — ваше доменное имя keycloak. Для последующей настройки интеграции вам потребуется импортировать публичный ключ в формате PKCS12 . Для его экспорта используйте следующую команду: openssl pkcs12 -export -out cert.p12 -in service.cert -inkey service.key -name learn Создавать пользователей в момент авторизации — установите параметр в значение Да , чтобы отсутствующие внешние или внутренние пользователи создавались автоматически при попытке авторизации пользователя в системе; Преобразовывать существующих пользователей — установите параметр в значение Да , если необходимо обновлять существующих пользователей в момент авторизации. При обновлении пользователь будет преобразован во внешнего SAML‑пользователя, при этом у него пропадёт возможность авторизации прежним способом; Обновлять данные существующих пользователей — установите параметр в значение Да , чтобы в момент аутентификации пользователя его данные в ELMA365 обновлялись на данные, полученные в SAML‑сообщении. Набор данных, которые отправляются в SAML‑сообщении, определяется при создании параметров на стороне провайдера аутентификации . Обратите внимание, если в SAML‑сообщении получены пустые значения, они также заменяют существующие данные пользователя в ELMA365; Использовать для пользователей — укажите, для кого будет возможна авторизация через SAML: для пользователей внешнего портала или для внутренних пользователей ELMA365. Нажмите Сохранить . После этого будет сгенерирована ссылка на файл метаданных, которая отобразится в поле URL метаданных . Перейдите по полученной ссылке и сохраните файл метаданных Service Provider в .xml формате. Он потребуется для финальной настройки SAML‑приложения на стороне Keycloak. Финальная настройка приложения SAML в Keycloak Вернитесь в интерфейс настройки Keycloak и импортируйте клиента с помощью файла метаданных, полученных при настройке интеграции SAML в ELMA365 на шаге 5. Для этого из левого меню перейдите в раздел Clients и нажмите кнопку Import client . На отрывшейся странице загрузите файл метаданных с помощью кнопки Browse . После сохранения откроется окно настройки приложения. Перейдите на вкладку Keys и с помощью кнопки Import Key импортируйте хранилище ключей cert.p12 , созданное при настройке интеграции SAML в ELMA365 на шаге 3. Укажите формат архивирования (в нашем примере это PKCS12 ), лэйбл, указанный после директивы -name при экспорте ключа, и пароль от хранилища. Для корректной работы интеграции на стороне Keycloak необходимо создать два обязательных для SAML‑параметра: windowsaccountname и externalCode . Если в настройках модуля SAML в ELMA365 включено обновление данных пользователей при аутентификации , добавленные параметры также определяют, какие данные будут обновляться. Для добавления параметров перейдите из левого меню в раздел Clients и выберите созданное приложение. Затем откройте вкладку Client scopes и снова выберите созданное приложение. На открывшейся странице на вкладке Mappers нажмите кнопку Add predefined mapper . Из открывшегося списка выберите role_list . На вкладке Mappers нажмите кнопку Add mapper . Из списка выберите By configuration . В открывшемся модальном окне выберите User attributes . Создайте два параметра со следующими данными: для windowsaccountname : Name * — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/windowsaccountname; User Attribute — windowsaccountname; SAML Attribute Name — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/windowsaccountname; SAML Attribute NameFormat — URL Reference. Параметр является обязательным. Атрибут будет сопоставлен с логином пользователя в ELMA365. для externalCode : Name * — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/externalCode; User Attribute — externalCode; SAML Attribute Name — http://schemas.xmlsoap.org/ws/2005/05/identity/claims/externalCode; SAML Attribute NameFormat — URL Reference. Параметр является обязательным. Используется для идентификации внешнего пользователя в ELMA365. Так как Keycloak будет являться поставщиком удостоверений, необходимо создать нового пользователя. Для этого из левого меню перейдите в раздел Users и создайте пользователя. Затем откройте вкладку Credentials и задайте для него пароль. На вкладке Attributes укажите значения для следующих атрибутов: externalCode — идентификатор пользователя, аналог objectGUID в ActiveDirectory; windowsaccountname — логин пользователя из интерфейса ELMA365. Также укажите электронную почту и имя пользователя. Нажмите Save . Удаление SAML-провайдера Если в системе нет пользователей, авторизованных через SAML-провайдера, его можно удалить. Для этого в настройках модуля SAML нажмите на значок корзины справа от названия и подтвердите действие. saml-with-azure.html audit_service.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/360004833572.html",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/external-users.html",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/add-external-users.html",
    "https://www.keycloak.org/guides",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/saml-with-keycloak.html",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/saml-with-azure.html",
    "https://elma365.com/ru/help/crm/ /ru/help/platform/audit_service.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T21:57:18.725859",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T21:57:18.893566"
  }
}