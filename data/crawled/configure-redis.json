{
  "doc_id": "configure-redis",
  "url": "https://elma365.com/ru/help/ecm/ru/help/platform/configure-redis.html",
  "title": "Кластер Redis",
  "breadcrumbs": [
    "ELMA365 On-Premises",
    "Подготовка инфраструктуры ELMA365 On-Premises"
  ],
  "section": "ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises | [ecm]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Кластер Redis</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"В статье описана установка Redis 6.2.12 для ОС Ubuntu Linux 20.04 и 22.04. Перед установкой проверьте допустимые версии Redis в статье «Системные требования ELMA365...\" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/platform/configure-redis.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p><a href=\"elma365-on-premises.html\">ELMA365 On-Premises</a> &gt; <a href=\"infrastructure-preparation.html\">Подготовка инфраструктуры ELMA365 On-Premises</a> &gt; Базы данных &gt; Отказоустойчивая инфраструктура / Кластер Redis</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Кластер Redis</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p class=\"p_Normal\">В статье описана установка Redis 6.2.12 для ОС Ubuntu Linux 20.04 и 22.04. Перед установкой проверьте допустимые версии Redis в статье <a class=\"topiclink\" href=\"elma365-enterprise-on-premises.html#valkey\">«Системные требования ELMA365 On-Premises»</a>. Вы также можете ознакомиться с руководством в <a class=\"weblink\" href=\"https://redis.io/docs/management/sentinel/\" target=\"_blank\">официальной документации Redis</a>.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">начало внимание</span></p>\n<p class=\"p_Normal\">В связи с изменением лицензионной политики Redis рекомендуем устанавливать Valkey в качестве альтернативного решения. Подробнее об установке читайте в статье <a class=\"topiclink\" href=\"valkey-cluster.html\">«Кластер Valkey»</a>.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец внимание</span></p>\n<p class=\"p_Normal\">Развёртывание кластера Redis включает этапы:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\"><a class=\"topiclink\" href=\"configure-redis.html#preparation-node\">Подготовка нод (серверов)</a>.</li><li class=\"p_Normal\" value=\"2\"><a class=\"topiclink\" href=\"configure-redis.html#installation\">Установка Redis и Sentinel</a>.</li><li class=\"p_Normal\" value=\"3\"><a class=\"topiclink\" href=\"configure-redis.html#redis-setup\">Настройка Redis</a>.</li><li class=\"p_Normal\" value=\"4\"><a class=\"topiclink\" href=\"configure-redis.html#sentinel-setup\">Настройка Sentinel</a>.</li><li class=\"p_Normal\" value=\"5\"><a class=\"topiclink\" href=\"configure-redis.html#connection-to-redis\">Подключение к Redis</a>.</li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"preparation-node\"></a><span class=\"f_Heading2\">Шаг 1. Подготовка нод (серверов)</span></h2>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">начало внимание</span></p>\n<p class=\"p_Normal\">Минимальное количество серверов для организации кластера — три.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец внимание</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Создайте три ноды (сервера) с последовательно пронумерованными именами хостов:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><span style=\"font-weight: bold;\">redis-server1.your_domain</span>;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">redis-server2.your_domain</span>;</li><li class=\"p_Normal\"><span style=\"font-weight: bold;\">redis-server3.your_domain</span>.</li></ul>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Создайте необходимые сопоставления имён хостов в DNS. Если такой возможности нет, внесите нужные записи в <code><b>/etc/hosts</b></code>.</li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"installation\"></a><span class=\"f_Heading2\">Шаг 2. Установка Redis и Sentinel</span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Установите необходимые пакеты:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt install lsb-release curl gpg</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Импортируйте необходимые ключи и добавьте репозиторий Redis:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">curl -fsSL https</span><span class=\"f_CodeExample\">://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg</span><br/>\n<span class=\"f_CodeExample\">echo \"deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/redis.list</span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: auto;\" value=\"3\">Обновите кеш пакетов:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt-get update</span></p>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: auto;\" value=\"4\">Установите Redis:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt-get -y install redis=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-server=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-tools=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-sentinel=6:6.2.12-1rl1~$(lsb_release -cs)1</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"redis-setup\"></a><span class=\"f_Heading2\">Шаг 3. Настройка Redis</span></h2>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Начало примечание</span></p>\n<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Примечание</span></p>\n<p class=\"p_Normal\">Для пароля разрешается применять следующие символы:</p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">заглавные латинские буквы: от A до Z;</li><li class=\"p_Normal\">строчные латинские буквы: от a до z;</li><li class=\"p_Normal\">цифры от 0 до 9;</li><li class=\"p_Normal\">символы:  -_.</li></ul>\n<p class=\"p_Normal\">Зарезервированные (недопустимые) символы:</p>\n<p class=\"p_Normal\">! * ' ( ) ; : @ &amp; = + $ , / ? % # [ ]</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец примечание</span></p>\n<p class=\"p_Normal\">Для настройки отредактируйте файл <code><b>/etc/redis/redis.conf</b></code> на каждом из серверов:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo nano /etc/redis/redis.conf</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Сделайте сервера доступными для всех IP-адресов данного сервера. Это делает сервис Redis доступным со всех внешних адресов:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">bind 0.0.0.0 </span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Увеличьте максимальное количество клиентов, изменив значение параметра <code><b>maxclients</b></code> на <code><b>20000</b></code>. Раскомментируйте строку, убрав знак решетки #:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">maxclients 20000</span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"3\">Задайте политику вытеснения ключей, изменив значение параметра <code><b>maxmemory-policy</b></code> на <code><b>allkeys-lfu</b></code>. Раскомментируйте строку, убрав знак решетки #:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">maxmemory-policy allkeys-lfu</span></p>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"4\">Отключите создание <span style=\"font-weight: bold;\">snapshots</span>, изменив значение параметра <code><b>save</b></code> на <code><b>\"\"</b></code>. Раскомментируйте строку, убрав знак решетки #:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">save \"\"</span></p>\n<ol start=\"5\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"5\">Отключите <span style=\"font-weight: bold;\">AOF</span> (сохранение базы данных Redis в файл). Для этого замените значение параметра <code><b>appendonly</b></code> на <code><b>no</b></code>. Раскомментируйте строку, убрав знак решетки #:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">appendonly no</span></p>\n<ol start=\"6\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" style=\"background: #ffffff;\" value=\"6\">Укажите пароль к мастеру:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">masterauth SecretPassword</span></p>\n<ol start=\"7\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"7\">Укажите домен (FQDN) для представления ноды в кластере:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде <code><b>redis-server1.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip redis-server1.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде <code><b>redis-server2.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip redis-server2.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде <code><b>redis-server3.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">replica-announce-ip redis-server3.your_domain</span></p>\n<ol start=\"8\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"8\"><span style=\"font-size: 15px; font-family: 'Segoe UI',Tahoma,Verdana,Arial,sans-serif; background-color: #ffffff;\">Укажите пароль для доступа:</span></li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">requirepass SecretPassword</span></p>\n<ol start=\"9\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"9\">На нодах <code><b>redis-server2.your_domain</b></code> и<span style=\"font-weight: bold;\"> </span><code><b>redis-server3.your_domain</b></code> укажите домен (FQDN) и порт для подключения к ноде Мастера (<code><b>redis-server1.your_domain</b></code>):</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">replicaof redis-server1.your_domain 6379</span></p>\n<ol start=\"10\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"10\">Перезапустите все сервера (сначала мастер, затем слейвы):</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart redis-server</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable redis-server</span></p>\n<ol start=\"11\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"11\">Проверьте статус репликации на ноде <code><b>redis-server1.your_domain</b></code>:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -a SecretPassword info replication</span></p>\n<p class=\"p_Normal\">Если не возникло ошибки, настройки проведена успешно. </p>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A1')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Настройка включения TLS/SSL в Redis</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A1\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_Normal\"> <br/>\nДля включения поддержки TLS/SSL в Redis необходимо в файле конфигурации <code><b>redis.conf</b></code>:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\">Отключить незащищённые подключения, выставив <code><b>0</b></code> в параметре <code><b>port</b></code>. </li><li class=\"p_Normal\" value=\"2\">Задать порт для TLS подключений, расскоментировав параметр <code><b>tls-port</b></code>.</li><li class=\"p_Normal\" value=\"3\">В параметре <code><b>tls-cert-file</b></code> указать путь до файла сертификата сервера.</li><li class=\"p_Normal\" value=\"4\">В параметре <code><b>tls-key-file</b></code> указать путь до файла закрытого ключа.</li><li class=\"p_Normal\" value=\"5\">В параметре <code><b>tls-ca-cert-file</b></code> указать путь до файла корневого CA.</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">port 0</span><br/>\n<span class=\"f_CodeExample\">tls-port 6379</span><br/>\n<span class=\"f_CodeExample\">tls-cert-file /path/to/redis.crt</span><br/>\n<span class=\"f_CodeExample\">tls-key-file /path/to/redis.key</span><br/>\n<span class=\"f_CodeExample\">tls-ca-cert-file /path/to/ca.crt</span></p>\n<ol start=\"6\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"6\">Перезапустить все сервера (сначала мастер, затем слейвы):</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart redis-server</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable redis-server</span></p>\n<ol start=\"7\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"7\">Проверить статус репликации на ноде <code><b>redis-server1.your_domain</b></code>:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 6379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key -a SecretPassword info replication</span></p>\n<p class=\"p_Normal\"> <br/>\nПодробнее о настройке TLS/SSL в Redis читайте в <a class=\"weblink\" href=\"https://redis.io/docs/management/security/encryption/\" target=\"_blank\">официальной документации Redis</a>.</p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"sentinel-setup\"></a><span class=\"f_Heading2\">Шаг 4. Настройка Sentinel</span></h2>\n<p class=\"p_Normal\">Чтобы настроить Sentinel, отредактируйте файл <code><b>/etc/redis/sentinel.conf</b></code> на каждом из серверов.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Начало внимание</span> </p>\n<p>Для корректной работы соблюдайте указанный порядок записей в файле <code><b>/etc/redis/sentinel.conf</b></code>.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">Конец внимание</span></p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Сделайте сервера доступными для всех IP-адресов данного сервера. Это делает сервис Sentinel доступным со всех внешних адресов:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">bind 0.0.0.0 </span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Укажите домен (FQDN) для представления нод Sentinel:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде <code><b>redis-server1.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip redis-server1.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде<span style=\"font-weight: bold;\"> </span><code><b>redis-server2.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip redis-server2.your_domain</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\">на ноде <code><b>redis-server3.your_domain</b></code>:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel announce-ip redis-server3.your_domain</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"3\">Укажите домен (FQDN) и порт мастера, а также значение для достижения кворума:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel monitor mymaster redis-server1.your_domain 6379 2</span></p>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"4\">Укажите пароль для доступа к мастеру:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel auth-pass mymaster SecretPassword</span></p>\n<ol start=\"5\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"5\">Укажите время, после которого мастер будет считаться упавшим:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel down-after-milliseconds mymaster 3000</span></p>\n<ol start=\"6\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"6\">Укажите время ожидания после смены ролей слейва на мастер в случае, если мастер вышел из строя:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel failover-timeout mymaster 6000</span></p>\n<ol start=\"7\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"7\">Включите поддержку разрешения имён хостов:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sentinel resolve-hostnames yes</span><br/>\n<span class=\"f_CodeExample\">sentinel announce-hostnames yes</span></p>\n<ol start=\"8\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"8\">Для повышения безопасности настройте для пользователя <span style=\"font-weight: bold;\">default</span> доступ к Sentinel только по паролю:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">user </span><span class=\"f_CodeExample\">default</span><span class=\"f_CodeExample\"> on &gt;SecretPassword sanitize-payload ~* &amp;* +@all</span></p>\n<ol start=\"8\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"9\">После этого перезапустите все сервера:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart redis-sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable redis-sentinel</span></p>\n<ol start=\"10\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"10\">Проверьте статус Sentinel и состояние кворума на ноде <span style=\"font-weight: bold;\">redis-server1.your_domain</span>, используя разные команды в зависимости от использования TLS/SSL и настройки Sentinel:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"page-break-inside: avoid;\">без TLS/SSL, если доступ к Sentinel по паролю не включён:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 26379 info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo redis-cli -p 26379 sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"page-break-inside: avoid;\">без TLS/SSL, если настроен доступ к Sentinel только по паролю:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 26379 -a SecretPassword info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo redis-cli -p 26379 -a SecretPassword sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"page-break-inside: avoid;\">с TLS/SSL, если доступ к Sentinel по паролю не включён:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_CodeExample\" style=\"page-break-inside: avoid;\">с TLS/SSL, если настроен доступ к Sentinel только по паролю:</li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 26379 -a SecretPassword -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo redis-cli -p 26379 -a SecretPassword -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster</span></p>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A2')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Настройка включения TLS/SSL в Sentinel</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A2\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_Normal\"> <br/>\nДля включения поддержки TLS/SSL в Sentinel необходимо в файле конфигурации <code><b>sentinel.conf</b></code>:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\">Отключить незащищённые подключения, выставив <code><b>0</b></code> в параметре <code><b>port</b></code>. </li><li class=\"p_Normal\" value=\"2\">Задать порт для TLS подключений, добавив параметр <code><b>tls-port</b></code>.</li><li class=\"p_Normal\" value=\"3\">Добавить параметр <code><b>tls-cert-file</b></code> и указать в нём путь до файла сертификата сервера.</li><li class=\"p_Normal\" value=\"4\">Добавить параметр <code><b>tls-key-file</b></code> и указать в нём путь до файла закрытого ключа.</li><li class=\"p_Normal\" value=\"5\">Добавить параметр <code><b>tls-ca-cert-file</b></code> и указать в нём путь до файла корневого CA.</li><li class=\"p_Normal\" value=\"6\">Добавить параметр <code><b>tls-replication</b></code> и включить поддержку TLS, указав значение <code><b>yes</b></code>.</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">port 0</span><br/>\n<span class=\"f_CodeExample\">tls-port 26379</span><br/>\n<span class=\"f_CodeExample\">tls-cert-file /path/to/redis.crt</span><br/>\n<span class=\"f_CodeExample\">tls-key-file /path/to/redis.key</span><br/>\n<span class=\"f_CodeExample\">tls-ca-cert-file /path/to/ca.crt</span><br/>\n<span class=\"f_CodeExample\">tls-replication yes</span></p>\n<ol start=\"7\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"7\">После этого перезапустить все сервера:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl restart redis-sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl enable redis-sentinel</span></p>\n<ol start=\"8\" style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"8\">Проверить статус Sentinel и состояние кворума на ноде <code><b>redis-server1.your_domain</b></code>:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel</span><br/>\n<span class=\"f_CodeExample\">sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster</span></p>\n<p class=\"p_Normal\"> <br/>\nПодробнее о настройке TLS/SSL в Sentinel читайте в <a class=\"weblink\" href=\"https://redis.io/docs/management/security/encryption/#sentinel\" target=\"_blank\">официальной документации Redis</a>.</p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"connection-to-redis\"></a><span class=\"f_Heading2\">Шаг 5. Подключение к Redis</span></h2>\n<p style=\"line-height: 1.28; margin: 0 0 11px 0;\"><span style=\"font-size: 15px; font-family: Inter;\">Подключитесь к Redis. Строка подключения зависит от использования TLS/SSL и настройки Sentinel:</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\"><span style=\"font-size: 15px; font-family: Inter;\">без TLS/SSL, если доступ к Sentinel только по паролю не включён:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">redis://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\"><span style=\"font-size: 15px; font-family: Inter;\">без TLS/SSL, если настроен доступ к Sentinel только по паролю:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">redis://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster&amp;sentinelUsername=default&amp;sentinelPassword=SecretPassword</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\"><span style=\"font-size: 15px; font-family: Inter;\">с TLS/SSL, если доступ к Sentinel по паролю не включён:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">rediss://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster</span></p>\n<ul style=\"list-style-type:disc\">\n<li style=\"line-height: 1.28; margin-top: 0; margin-right: 0; margin-bottom: 11px;\"><span style=\"font-size: 15px; font-family: Inter;\">с TLS/SSL, если настроен доступ к Sentinel только по паролю:</span></li></ul>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">rediss://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster&amp;sentinelUsername=default&amp;sentinelPassword=SecretPassword</span></p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"cluster-redis-to-valkey.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">cluster-redis-to-valkey.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"configure-rabbitmq.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">configure-rabbitmq.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n<script type=\"text/javascript\">\nHMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A2','hm.type','dropdown','hm.state','0');\n</script>\n</body>\n</html>\n",
  "plain_text": "Кластер Redis ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises > Базы данных > Отказоустойчивая инфраструктура / Кластер Redis Кластер Redis В статье описана установка Redis 6.2.12 для ОС Ubuntu Linux 20.04 и 22.04. Перед установкой проверьте допустимые версии Redis в статье «Системные требования ELMA365 On-Premises» . Вы также можете ознакомиться с руководством в официальной документации Redis . начало внимание В связи с изменением лицензионной политики Redis рекомендуем устанавливать Valkey в качестве альтернативного решения. Подробнее об установке читайте в статье «Кластер Valkey» . конец внимание Развёртывание кластера Redis включает этапы: Подготовка нод (серверов) . Установка Redis и Sentinel . Настройка Redis . Настройка Sentinel . Подключение к Redis . Шаг 1. Подготовка нод (серверов) начало внимание Минимальное количество серверов для организации кластера — три. конец внимание Создайте три ноды (сервера) с последовательно пронумерованными именами хостов: redis-server1.your_domain ; redis-server2.your_domain ; redis-server3.your_domain . Создайте необходимые сопоставления имён хостов в DNS. Если такой возможности нет, внесите нужные записи в /etc/hosts . Шаг 2. Установка Redis и Sentinel Установите необходимые пакеты: sudo apt install lsb-release curl gpg Импортируйте необходимые ключи и добавьте репозиторий Redis: curl -fsSL https ://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg echo \"deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main\" | sudo tee /etc/apt/sources.list.d/redis.list Обновите кеш пакетов: sudo apt-get update Установите Redis: sudo apt-get -y install redis=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-server=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-tools=6:6.2.12-1rl1~$(lsb_release -cs)1 redis-sentinel=6:6.2.12-1rl1~$(lsb_release -cs)1 Шаг 3. Настройка Redis Начало примечание Примечание Для пароля разрешается применять следующие символы: заглавные латинские буквы: от A до Z; строчные латинские буквы: от a до z; цифры от 0 до 9; символы: -_. Зарезервированные (недопустимые) символы: ! * ' ( ) ; : @ & = + $ , / ? % # [ ] конец примечание Для настройки отредактируйте файл /etc/redis/redis.conf на каждом из серверов: sudo nano /etc/redis/redis.conf Сделайте сервера доступными для всех IP-адресов данного сервера. Это делает сервис Redis доступным со всех внешних адресов: bind 0.0.0.0 Увеличьте максимальное количество клиентов, изменив значение параметра maxclients на 20000 . Раскомментируйте строку, убрав знак решетки #: maxclients 20000 Задайте политику вытеснения ключей, изменив значение параметра maxmemory-policy на allkeys-lfu . Раскомментируйте строку, убрав знак решетки #: maxmemory-policy allkeys-lfu Отключите создание snapshots , изменив значение параметра save на \"\" . Раскомментируйте строку, убрав знак решетки #: save \"\" Отключите AOF (сохранение базы данных Redis в файл). Для этого замените значение параметра appendonly на no . Раскомментируйте строку, убрав знак решетки #: appendonly no Укажите пароль к мастеру: masterauth SecretPassword Укажите домен (FQDN) для представления ноды в кластере: на ноде redis-server1.your_domain : replica-announce-ip redis-server1.your_domain на ноде redis-server2.your_domain : replica-announce-ip redis-server2.your_domain на ноде redis-server3.your_domain : replica-announce-ip redis-server3.your_domain Укажите пароль для доступа: requirepass SecretPassword На нодах redis-server2.your_domain и redis-server3.your_domain укажите домен (FQDN) и порт для подключения к ноде Мастера ( redis-server1.your_domain ): replicaof redis-server1.your_domain 6379 Перезапустите все сервера (сначала мастер, затем слейвы): sudo systemctl restart redis-server sudo systemctl enable redis-server Проверьте статус репликации на ноде redis-server1.your_domain : sudo redis-cli -a SecretPassword info replication Если не возникло ошибки, настройки проведена успешно. Настройка включения TLS/SSL в Redis Для включения поддержки TLS/SSL в Redis необходимо в файле конфигурации redis.conf : Отключить незащищённые подключения, выставив 0 в параметре port . Задать порт для TLS подключений, расскоментировав параметр tls-port . В параметре tls-cert-file указать путь до файла сертификата сервера. В параметре tls-key-file указать путь до файла закрытого ключа. В параметре tls-ca-cert-file указать путь до файла корневого CA. port 0 tls-port 6379 tls-cert-file /path/to/redis.crt tls-key-file /path/to/redis.key tls-ca-cert-file /path/to/ca.crt Перезапустить все сервера (сначала мастер, затем слейвы): sudo systemctl restart redis-server sudo systemctl enable redis-server Проверить статус репликации на ноде redis-server1.your_domain : sudo redis-cli -p 6379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key -a SecretPassword info replication Подробнее о настройке TLS/SSL в Redis читайте в официальной документации Redis . Шаг 4. Настройка Sentinel Чтобы настроить Sentinel, отредактируйте файл /etc/redis/sentinel.conf на каждом из серверов. Начало внимание Для корректной работы соблюдайте указанный порядок записей в файле /etc/redis/sentinel.conf . Конец внимание Сделайте сервера доступными для всех IP-адресов данного сервера. Это делает сервис Sentinel доступным со всех внешних адресов: bind 0.0.0.0 Укажите домен (FQDN) для представления нод Sentinel: на ноде redis-server1.your_domain : sentinel announce-ip redis-server1.your_domain на ноде redis-server2.your_domain : sentinel announce-ip redis-server2.your_domain на ноде redis-server3.your_domain : sentinel announce-ip redis-server3.your_domain Укажите домен (FQDN) и порт мастера, а также значение для достижения кворума: sentinel monitor mymaster redis-server1.your_domain 6379 2 Укажите пароль для доступа к мастеру: sentinel auth-pass mymaster SecretPassword Укажите время, после которого мастер будет считаться упавшим: sentinel down-after-milliseconds mymaster 3000 Укажите время ожидания после смены ролей слейва на мастер в случае, если мастер вышел из строя: sentinel failover-timeout mymaster 6000 Включите поддержку разрешения имён хостов: sentinel resolve-hostnames yes sentinel announce-hostnames yes Для повышения безопасности настройте для пользователя default доступ к Sentinel только по паролю: user default on >SecretPassword sanitize-payload ~* &* +@all После этого перезапустите все сервера: sudo systemctl restart redis-sentinel sudo systemctl enable redis-sentinel Проверьте статус Sentinel и состояние кворума на ноде redis-server1.your_domain , используя разные команды в зависимости от использования TLS/SSL и настройки Sentinel: без TLS/SSL, если доступ к Sentinel по паролю не включён: sudo redis-cli -p 26379 info sentinel sudo redis-cli -p 26379 sentinel ckquorum mymaster без TLS/SSL, если настроен доступ к Sentinel только по паролю: sudo redis-cli -p 26379 -a SecretPassword info sentinel sudo redis-cli -p 26379 -a SecretPassword sentinel ckquorum mymaster с TLS/SSL, если доступ к Sentinel по паролю не включён: sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster с TLS/SSL, если настроен доступ к Sentinel только по паролю: sudo redis-cli -p 26379 -a SecretPassword -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel sudo redis-cli -p 26379 -a SecretPassword -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster Настройка включения TLS/SSL в Sentinel Для включения поддержки TLS/SSL в Sentinel необходимо в файле конфигурации sentinel.conf : Отключить незащищённые подключения, выставив 0 в параметре port . Задать порт для TLS подключений, добавив параметр tls-port . Добавить параметр tls-cert-file и указать в нём путь до файла сертификата сервера. Добавить параметр tls-key-file и указать в нём путь до файла закрытого ключа. Добавить параметр tls-ca-cert-file и указать в нём путь до файла корневого CA. Добавить параметр tls-replication и включить поддержку TLS, указав значение yes . port 0 tls-port 26379 tls-cert-file /path/to/redis.crt tls-key-file /path/to/redis.key tls-ca-cert-file /path/to/ca.crt tls-replication yes После этого перезапустить все сервера: sudo systemctl restart redis-sentinel sudo systemctl enable redis-sentinel Проверить статус Sentinel и состояние кворума на ноде redis-server1.your_domain : sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key info sentinel sudo redis-cli -p 26379 -h redis-server1.your_domain --tls --cacert /path/to/ca.crt --cert /path/to/redis.crt --key /path/to/redis.key sentinel ckquorum mymaster Подробнее о настройке TLS/SSL в Sentinel читайте в официальной документации Redis . Шаг 5. Подключение к Redis Подключитесь к Redis. Строка подключения зависит от использования TLS/SSL и настройки Sentinel: без TLS/SSL, если доступ к Sentinel только по паролю не включён: redis://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster без TLS/SSL, если настроен доступ к Sentinel только по паролю: redis://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster&sentinelUsername=default&sentinelPassword=SecretPassword с TLS/SSL, если доступ к Sentinel по паролю не включён: rediss://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster с TLS/SSL, если настроен доступ к Sentinel только по паролю: rediss://:SecretPassword@redis-server1.your_domain:26379,redis-server2.your_domain:26379,redis-server3.your_domain:26379/0?masterName=mymaster&sentinelUsername=default&sentinelPassword=SecretPassword cluster-redis-to-valkey.html configure-rabbitmq.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/ecm/ru/help/platform/elma365-on-premises.html",
    "https://elma365.com/ru/help/ecm/ru/help/platform/infrastructure-preparation.html",
    "https://elma365.com/ru/help/ecm/ru/help/platform/elma365-enterprise-on-premises.html",
    "https://redis.io/docs/management/sentinel/",
    "https://elma365.com/ru/help/ecm/ru/help/platform/valkey-cluster.html",
    "https://elma365.com/ru/help/ecm/ru/help/platform/configure-redis.html",
    "https://redis.io/docs/management/security/encryption/",
    "https://elma365.com/ru/help/ecm/ru/help/platform/cluster-redis-to-valkey.html",
    "https://elma365.com/ru/help/ecm/ru/help/platform/configure-rabbitmq.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T21:51:50.023104",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T21:51:50.097746"
  }
}