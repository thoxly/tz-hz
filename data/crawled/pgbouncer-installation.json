{
  "doc_id": "pgbouncer-installation",
  "url": "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/pgbouncer-installation.html",
  "title": "Установка PGBouncer",
  "breadcrumbs": [
    "ELMA365 On-Premises",
    "Подготовка инфраструктуры ELMA365 On-Premises"
  ],
  "section": "ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises | [business_solutions]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Установка PGBouncer</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"PGBouncer — программа, управляющая пулом соединений PostgreSQL. Любое конечное приложение может подключиться к PGBouncer, как если бы это был непосредственно сервер PostgreSQL....\" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/platform/pgbouncer-installation.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p><a href=\"elma365-on-premises.html\">ELMA365 On-Premises</a> &gt; <a href=\"infrastructure-preparation.html\">Подготовка инфраструктуры ELMA365 On-Premises</a> &gt; Балансировщик нагрузки / Установка PGBouncer</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Установка PGBouncer</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p class=\"p_Normal\">PGBouncer — программа, управляющая пулом соединений PostgreSQL. Любое конечное приложение может подключиться к PGBouncer, как если бы это был непосредственно сервер PostgreSQL. PGBouncer создаст подключение к реальному серверу, либо задействует одно из ранее установленных подключений. </p>\n<p class=\"p_Normal\">Назначение PGBouncer — минимизировать издержки, связанные с установлением новых подключений к PostgreSQL. Вы также можете ознакомиться с руководством в <a class=\"weblink\" href=\"https://www.pgbouncer.org/faq.html\" target=\"_blank\">официальной документации PGBouncer</a>.</p>\n<p class=\"p_Normal\">Установка состоит из нескольких этапов:</p>\n<ol style=\"list-style-type:decimal\">\n<li class=\"p_Normal\" value=\"1\"><a class=\"topiclink\" href=\"pgbouncer-installation.html#install-pgbouncer\">Установка PGBouncer</a>.</li><li class=\"p_Normal\" value=\"2\"><a class=\"topiclink\" href=\"pgbouncer-installation.html#configure-pgbouncer\">Настройка PGBouncer</a>.</li><li class=\"p_Normal\" value=\"3\"><a class=\"topiclink\" href=\"pgbouncer-installation.html#add-users\">Добавление пользователей</a>.</li><li class=\"p_Normal\" value=\"4\"><a class=\"topiclink\" href=\"pgbouncer-installation.html#set-limitnofile\">Задание LimitNOFILE в файле pgbouncer.service</a>.</li><li class=\"p_Normal\" value=\"5\"><a class=\"topiclink\" href=\"pgbouncer-installation.html#connect-to-pgbouncer\">Подключение к PGBouncer</a>.</li></ol>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"install-pgbouncer\"></a><span class=\"f_Heading2\">Шаг 1. Установка PGBouncer</span></h2>\n<p class=\"p_Normal\">Установите PGBouncer на узел с PostgreSQL, используя следующую команду:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo apt-get install pgbouncer -y</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"configure-pgbouncer\"></a><span class=\"f_Heading2\">Шаг 2. Настройка PGBouncer</span></h2>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Переместите конфигурационный файл по умолчанию:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo mv /etc/pgbouncer/pgbouncer.ini{,.original}</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Создайте и откройте для редактирования новый конфигурационный файл:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo nano /etc/pgbouncer/pgbouncer.ini</span></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"3\">Добавьте пример конфигураций в файл:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">[databases]</span><br/>\n<span class=\"f_CodeExample\">postgres = host=127.0.0.1 port=5432 dbname=elma365</span><br/>\n<span class=\"f_CodeExample\">* = host=127.0.0.1 port=5432</span><br/>\n<span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">[pgbouncer]</span><br/>\n<span class=\"f_CodeExample\">logfile = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/log/postgresql/pgbouncer.log</span><br/>\n<span class=\"f_CodeExample\">pidfile = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/run/postgresql/pgbouncer.pid</span><br/>\n<span class=\"f_CodeExample\">listen_addr = *</span><br/>\n<span class=\"f_CodeExample\">listen_port = 6432</span><br/>\n<span class=\"f_CodeExample\">unix_socket_dir = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/run/postgresql</span><br/>\n<span class=\"f_CodeExample\">auth_type = md5</span><br/>\n<span class=\"f_CodeExample\">auth_file = /etc/pgbouncer/userlist.txt</span><br/>\n<span class=\"f_CodeExample\">admin_users = postgres</span><br/>\n<span class=\"f_CodeExample\">ignore_startup_parameters = extra_float_digits,geqo</span><br/>\n<span class=\"f_CodeExample\">pool_mode = session</span><br/>\n<span class=\"f_CodeExample\">server_reset_query = DISCARD ALL</span><br/>\n<span class=\"f_CodeExample\">max_client_conn = 10000</span><br/>\n<span class=\"f_CodeExample\">default_pool_size = 800</span><br/>\n<span class=\"f_CodeExample\">reserve_pool_size = 150</span><br/>\n<span class=\"f_CodeExample\">reserve_pool_timeout = 1</span><br/>\n<span class=\"f_CodeExample\">max_db_connections = 1000</span><br/>\n<span class=\"f_CodeExample\">pkt_buf = 8192</span><br/>\n<span class=\"f_CodeExample\">listen_backlog = 4096</span><br/>\n<span class=\"f_CodeExample\">log_connections = 0</span><br/>\n<span class=\"f_CodeExample\">log_disconnections = 0</span></p>\n<p class=\"p_Normal\">где:</p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><code><b>listen_addr</b></code> — список адресов через запятую, где прослушивать соединения TCP. Если вы установите <code><b>*</b></code>, будут прослушивать все адреса;</li><li class=\"p_Normal\"><code><b>listen_port</b></code> — порт для прослушивания, по умолчанию установлено <code><b>6432</b></code>;</li><li class=\"p_Normal\"><code><b>pool_mode</b></code> — режим работы;</li><li class=\"p_Normal\"><code><b>auth_type</b></code> — режим аутентификации пользователей;</li><li class=\"p_Normal\"><code><b>max_client_conn</b></code> — максимально допустимое количество клиентских подключений;</li><li class=\"p_Normal\"><code><b>default_pool_size</b></code> — размер пула открытых подключений к базам данных;</li><li class=\"p_Normal\"><code><b>reserve_pool_size</b></code> — размер резервного пула открытых подключений к базам данных;</li><li class=\"p_Normal\"><code><b>max_db_connections</b></code> — максимально допустимое количество открытых подключений к базам данных;</li><li class=\"p_Normal\"><code><b>[databases]</b></code> — определяет имена баз данных, к которым могут подключаться клиенты PgBouncer. Указывает, куда будут маршрутизироваться эти подключения.</li></ul>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A1')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Настройка включения TLS/SSL в PGBouncer</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A1\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_Normal\"> <br/>\nДля включения поддержки TLS/SSL в PGBouncer дабавьте в файл конфигурации <code><b>/etc/pgbouncer/pgbouncer.ini</b></code> следующие параметры:</p>\n<ul style=\"list-style-type:disc\">\n<li class=\"p_Normal\"><code><b>client_tls_sslmode</b></code> — задайте режим работы TLS, выставив <code><b>require</b></code>;</li><li class=\"p_Normal\"><code><b>client_tls_ca_file</b></code> — укажите путь до файла корневого CA;</li><li class=\"p_Normal\"><code><b>client_tls_cert_file</b></code> — укажите путь до файла сертификата сервера;</li><li class=\"p_Normal\"><code><b>client_tls_key_file</b></code> — укажите путь до файла закрытого ключа.</li></ul>\n<p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: avoid;\"><span class=\"f_CodeExample\">[databases]</span><br/>\n<span class=\"f_CodeExample\">postgres = host=127.0.0.1 port=5432 dbname=elma365</span><br/>\n<span class=\"f_CodeExample\">* = host=127.0.0.1 port=5432</span><br/>\n<span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">[pgbouncer]</span><br/>\n<span class=\"f_CodeExample\">logfile = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/log/postgresql/pgbouncer.log</span><br/>\n<span class=\"f_CodeExample\">pidfile = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/run/postgresql/pgbouncer.pid</span><br/>\n<span class=\"f_CodeExample\">listen_addr = *</span><br/>\n<span class=\"f_CodeExample\">listen_port = 6432</span><br/>\n<span class=\"f_CodeExample\">unix_socket_dir = /</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">var</span><span class=\"f_CodeExample\">/run/postgresql</span><br/>\n<span class=\"f_CodeExample\">auth_type = md5</span><br/>\n<span class=\"f_CodeExample\">auth_file = /etc/pgbouncer/userlist.txt</span><br/>\n<span class=\"f_CodeExample\">admin_users = postgres</span><br/>\n<span class=\"f_CodeExample\">ignore_startup_parameters = extra_float_digits,geqo</span><br/>\n<span class=\"f_CodeExample\">pool_mode = session</span><br/>\n<span class=\"f_CodeExample\">server_reset_query = DISCARD ALL</span><br/>\n<span class=\"f_CodeExample\">max_client_conn = 10000</span><br/>\n<span class=\"f_CodeExample\">default_pool_size = 800</span><br/>\n<span class=\"f_CodeExample\">reserve_pool_size = 150</span><br/>\n<span class=\"f_CodeExample\">reserve_pool_timeout = 1</span><br/>\n<span class=\"f_CodeExample\">max_db_connections = 1000</span><br/>\n<span class=\"f_CodeExample\">pkt_buf = 8192</span><br/>\n<span class=\"f_CodeExample\">listen_backlog = 4096</span><br/>\n<span class=\"f_CodeExample\">log_connections = 0</span><br/>\n<span class=\"f_CodeExample\">log_disconnections = 0</span><br/>\n<span class=\"f_CodeExample\">client_tls_sslmode = require</span><br/>\n<span class=\"f_CodeExample\">client_tls_ca_file = /etc/ssl/certs/rootCA.pem</span><br/>\n<span class=\"f_CodeExample\">client_tls_key_file = /etc/ssl/</span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">private</span><span class=\"f_CodeExample\">/selfsigned.key</span><br/>\n<span class=\"f_CodeExample\">client_tls_cert_file = /etc/ssl/certs/selfsigned.crt</span></p>\n<p class=\"p_Normal\"> <br/>\nПодробнее о настройке TLS/SSL в PGBouncer читайте в <a class=\"weblink\" href=\"https://www.pgbouncer.org/config.html#tls-settings\" target=\"_blank\">официальной документации PGBouncer</a>.</p>\n</td>\n</tr>\n</table>\n</div>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"add-users\"></a><span class=\"f_Heading2\">Шаг 3. Добавление пользователей</span></h2>\n<p class=\"p_Normal\">Добавьте в файл <code><b>/etc/pgbouncer/userlist.txt</b></code> имена пользователей и пароли, с которыми PGBouncer подключается к базе. Для этого:</p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Создайте файл <code><b>userlist.txt</b></code>, выполнив команду:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo nano /etc/pgbouncer/userlist.txt</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Добавьте в файл <code><b>userlist.txt</b></code> пользователя и пароль для подключения к PostgreSQL. Пользователь <span style=\"font-weight: bold;\">elma365</span> был ранее создан при развёртывании PostgreSQL. Подробнее об этом читайте в статьях <a class=\"topiclink\" href=\"postgresql.html\">«PostgreSQL»</a> и <a class=\"topiclink\" href=\"configure-postgresql.html\">«Кластер PostgreSQL»</a>.</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">\"elma365\" \"SecretPassword\"</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"set-limitnofile\"></a><span class=\"f_Heading2\">Шаг 4. Задание LimitNOFILE в файле pgbouncer.service</span></h2>\n<p class=\"p_Normal\">Добавьте в файл сервиса PGBouncer в секцию <span style=\"font-weight: bold;\">Service</span> параметр <code><b>LimitNOFILE</b></code>.</p>\n<ol style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"1\">Откройте файл <code><b>/lib/systemd/system/pgbouncer.service</b></code>, выполнив команду:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo nano /lib/systemd/system/pgbouncer.service</span></p>\n<ol start=\"2\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"2\">Задайте лимит на открытие файлов <code><b>LimitNOFILE</b></code> равным <code><b>15000</b></code>.</li></ol>\n<p class=\"p_Normal\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A2')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">Пример добавления LimitNOFILE в pgbouncer.service</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A2\" style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">[Unit]</span><br/>\n<span class=\"f_CodeExample\">Description=connection pooler </span><span class=\"f_CodeExample\" style=\"font-weight: bold;\">for</span><span class=\"f_CodeExample\"> PostgreSQL</span><br/>\n<span class=\"f_CodeExample\">Documentation=man:pgbouncer(1)</span><br/>\n<span class=\"f_CodeExample\">Documentation=https:</span><span class=\"f_CodeExample\">//www.pgbouncer.org/</span><br/>\n<span class=\"f_CodeExample\">After=network.target</span><br/>\n<span class=\"f_CodeExample\">#Requires=pgbouncer.socket</span><br/>\n<span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">[Service]</span><br/>\n<span class=\"f_CodeExample\">Type=notify</span><br/>\n<span class=\"f_CodeExample\">User=postgres</span><br/>\n<span class=\"f_CodeExample\">ExecStart=/usr/sbin/pgbouncer /etc/pgbouncer/pgbouncer.ini</span><br/>\n<span class=\"f_CodeExample\">ExecReload=/bin/kill -HUP $MAINPID</span><br/>\n<span class=\"f_CodeExample\">KillSignal=SIGINT</span><br/>\n<span class=\"f_CodeExample\">LimitNOFILE=15000</span><br/>\n<span class=\"f_CodeExample\"> </span><br/>\n<span class=\"f_CodeExample\">[Install]</span><br/>\n<span class=\"f_CodeExample\">WantedBy=multi-user.target</span></p>\n</td>\n</tr>\n</table>\n</div>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li class=\"p_Normal\" value=\"3\">Перезапустите PGBouncer, выполнив команду:</li></ol>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">sudo systemctl daemon-reload</span><br/>\n<span class=\"f_CodeExample\">sudo systemctl restart pgbouncer</span></p>\n<h2 class=\"p_Heading2\"><a class=\"hmanchor\" id=\"connect-to-pgbouncer\"></a><span class=\"f_Heading2\">Шаг 5. Подключение к PGBouncer</span></h2>\n<p class=\"p_Normal\">Строка подключения к PGBouncer:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">postgresql:</span><span class=\"f_CodeExample\">//elma365:SecretPassword@&lt;postgresql-server-address&gt;:6432/elma365?sslmode=disable</span></p>\n<p class=\"p_Normal\">Строка подключения к PGBouncer с TLS/SSL:</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">postgresql:</span><span class=\"f_CodeExample\">//elma365:SecretPassword@&lt;postgresql-server-address&gt;:6432/elma365?sslmode=require</span></p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"proxy-s3-kubernetes.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">proxy-s3-kubernetes.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"installing-harbor.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">installing-harbor.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n<script type=\"text/javascript\">\nHMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A2','hm.type','dropdown','hm.state','0');\n</script>\n</body>\n</html>\n",
  "plain_text": "Установка PGBouncer ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 ELMA365 On-Premises > Подготовка инфраструктуры ELMA365 On-Premises > Балансировщик нагрузки / Установка PGBouncer Установка PGBouncer PGBouncer — программа, управляющая пулом соединений PostgreSQL. Любое конечное приложение может подключиться к PGBouncer, как если бы это был непосредственно сервер PostgreSQL. PGBouncer создаст подключение к реальному серверу, либо задействует одно из ранее установленных подключений. Назначение PGBouncer — минимизировать издержки, связанные с установлением новых подключений к PostgreSQL. Вы также можете ознакомиться с руководством в официальной документации PGBouncer . Установка состоит из нескольких этапов: Установка PGBouncer . Настройка PGBouncer . Добавление пользователей . Задание LimitNOFILE в файле pgbouncer.service . Подключение к PGBouncer . Шаг 1. Установка PGBouncer Установите PGBouncer на узел с PostgreSQL, используя следующую команду: sudo apt-get install pgbouncer -y Шаг 2. Настройка PGBouncer Переместите конфигурационный файл по умолчанию: sudo mv /etc/pgbouncer/pgbouncer.ini{,.original} Создайте и откройте для редактирования новый конфигурационный файл: sudo nano /etc/pgbouncer/pgbouncer.ini Добавьте пример конфигураций в файл: [databases] postgres = host=127.0.0.1 port=5432 dbname=elma365 * = host=127.0.0.1 port=5432 [pgbouncer] logfile = / var /log/postgresql/pgbouncer.log pidfile = / var /run/postgresql/pgbouncer.pid listen_addr = * listen_port = 6432 unix_socket_dir = / var /run/postgresql auth_type = md5 auth_file = /etc/pgbouncer/userlist.txt admin_users = postgres ignore_startup_parameters = extra_float_digits,geqo pool_mode = session server_reset_query = DISCARD ALL max_client_conn = 10000 default_pool_size = 800 reserve_pool_size = 150 reserve_pool_timeout = 1 max_db_connections = 1000 pkt_buf = 8192 listen_backlog = 4096 log_connections = 0 log_disconnections = 0 где: listen_addr — список адресов через запятую, где прослушивать соединения TCP. Если вы установите * , будут прослушивать все адреса; listen_port — порт для прослушивания, по умолчанию установлено 6432 ; pool_mode — режим работы; auth_type — режим аутентификации пользователей; max_client_conn — максимально допустимое количество клиентских подключений; default_pool_size — размер пула открытых подключений к базам данных; reserve_pool_size — размер резервного пула открытых подключений к базам данных; max_db_connections — максимально допустимое количество открытых подключений к базам данных; [databases] — определяет имена баз данных, к которым могут подключаться клиенты PgBouncer. Указывает, куда будут маршрутизироваться эти подключения. Настройка включения TLS/SSL в PGBouncer Для включения поддержки TLS/SSL в PGBouncer дабавьте в файл конфигурации /etc/pgbouncer/pgbouncer.ini следующие параметры: client_tls_sslmode — задайте режим работы TLS, выставив require ; client_tls_ca_file — укажите путь до файла корневого CA; client_tls_cert_file — укажите путь до файла сертификата сервера; client_tls_key_file — укажите путь до файла закрытого ключа. [databases] postgres = host=127.0.0.1 port=5432 dbname=elma365 * = host=127.0.0.1 port=5432 [pgbouncer] logfile = / var /log/postgresql/pgbouncer.log pidfile = / var /run/postgresql/pgbouncer.pid listen_addr = * listen_port = 6432 unix_socket_dir = / var /run/postgresql auth_type = md5 auth_file = /etc/pgbouncer/userlist.txt admin_users = postgres ignore_startup_parameters = extra_float_digits,geqo pool_mode = session server_reset_query = DISCARD ALL max_client_conn = 10000 default_pool_size = 800 reserve_pool_size = 150 reserve_pool_timeout = 1 max_db_connections = 1000 pkt_buf = 8192 listen_backlog = 4096 log_connections = 0 log_disconnections = 0 client_tls_sslmode = require client_tls_ca_file = /etc/ssl/certs/rootCA.pem client_tls_key_file = /etc/ssl/ private /selfsigned.key client_tls_cert_file = /etc/ssl/certs/selfsigned.crt Подробнее о настройке TLS/SSL в PGBouncer читайте в официальной документации PGBouncer . Шаг 3. Добавление пользователей Добавьте в файл /etc/pgbouncer/userlist.txt имена пользователей и пароли, с которыми PGBouncer подключается к базе. Для этого: Создайте файл userlist.txt , выполнив команду: sudo nano /etc/pgbouncer/userlist.txt Добавьте в файл userlist.txt пользователя и пароль для подключения к PostgreSQL. Пользователь elma365 был ранее создан при развёртывании PostgreSQL. Подробнее об этом читайте в статьях «PostgreSQL» и «Кластер PostgreSQL» . \"elma365\" \"SecretPassword\" Шаг 4. Задание LimitNOFILE в файле pgbouncer.service Добавьте в файл сервиса PGBouncer в секцию Service параметр LimitNOFILE . Откройте файл /lib/systemd/system/pgbouncer.service , выполнив команду: sudo nano /lib/systemd/system/pgbouncer.service Задайте лимит на открытие файлов LimitNOFILE равным 15000 . Пример добавления LimitNOFILE в pgbouncer.service [Unit] Description=connection pooler for PostgreSQL Documentation=man:pgbouncer(1) Documentation=https: //www.pgbouncer.org/ After=network.target #Requires=pgbouncer.socket [Service] Type=notify User=postgres ExecStart=/usr/sbin/pgbouncer /etc/pgbouncer/pgbouncer.ini ExecReload=/bin/kill -HUP $MAINPID KillSignal=SIGINT LimitNOFILE=15000 [Install] WantedBy=multi-user.target Перезапустите PGBouncer, выполнив команду: sudo systemctl daemon-reload sudo systemctl restart pgbouncer Шаг 5. Подключение к PGBouncer Строка подключения к PGBouncer: postgresql: //elma365:SecretPassword@<postgresql-server-address>:6432/elma365?sslmode=disable Строка подключения к PGBouncer с TLS/SSL: postgresql: //elma365:SecretPassword@<postgresql-server-address>:6432/elma365?sslmode=require proxy-s3-kubernetes.html installing-harbor.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/elma365-on-premises.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/infrastructure-preparation.html",
    "https://www.pgbouncer.org/faq.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/pgbouncer-installation.html",
    "https://www.pgbouncer.org/config.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/postgresql.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/configure-postgresql.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/proxy-s3-kubernetes.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/installing-harbor.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T22:03:20.560173",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T22:03:20.741103"
  }
}