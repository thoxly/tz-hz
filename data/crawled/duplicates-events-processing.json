{
  "doc_id": "duplicates-events-processing",
  "url": "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/duplicates-events-processing.html",
  "title": "Обработка событий в дублях",
  "breadcrumbs": [
    "Дубли в разделе CRM"
  ],
  "section": "Дубли в разделе CRM | [business_solutions]",
  "html": "<!DOCTYPE html>\n<html lang=\"ru\">\n<head>\n<title>Обработка событий в дублях</title>\n<meta content=\"Help+Manual\" name=\"generator\"/>\n<meta content=\"\" name=\"keywords\"/>\n<meta content=\"text/html; charset=utf-8\" http-equiv=\"Content-Type\"/>\n<meta content=\"IE=edge\" http-equiv=\"X-UA-Compatible\"/>\n<meta content=\"width=device-width, initial-scale=1.0\" name=\"viewport\"/>\n<meta content=\"Когда в приложении включён поиск похожих элементов, можно создать обработчик событий, который будет отслеживать объединение дублей и запускать нужные действия через...\" name=\"description\"/>\n<meta content=\"\" name=\"picture\"/>\n<meta content=\"website\" property=\"og:type\"/>\n<meta content=\"Cправка по Low-code платформе ELMA365\" property=\"og:title\"/>\n<meta content=\"https://elma365.com/ru/help\" property=\"og:url\"/>\n<meta content=\"\" property=\"og:image\"/>\n<meta content=\"ELMA365\" property=\"og:site_name\"/>\n<link href=\"favicon.png\" rel=\"icon\" type=\"image/png\"/>\n<link href=\"https://elma365.com/ru/help/crm/duplicates-events-processing.html\" rel=\"canonical\"/>\n<link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap\" rel=\"stylesheet\"/>\n<link href=\"./jquery-ui.min.css\" rel=\"stylesheet\"/>\n<link href=\"default.css\" rel=\"stylesheet\"/>\n<link href=\"./search-yandex.css\" rel=\"stylesheet\"/>\n<link href=\"./article.css\" rel=\"stylesheet\"/>\n<link href=\"./glossary.css\" rel=\"stylesheet\"/>\n<link href=\"./theme.css\" rel=\"stylesheet\"/>\n<link href=\"./tooltipster.bundle.min.css\" rel=\"stylesheet\" type=\"text/css\"/>\n<script src=\"jquery.js\" type=\"text/javascript\"></script>\n<script src=\"./tooltipster.bundle.min.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n        $(document).ready($('.tooltip').tooltipster({\n            contentCloning: true,\n            theme: 'tooltipster-borderless',\n        }));\n    </script>\n<script src=\"helpman_settings.js\" type=\"text/javascript\"></script>\n<script src=\"helpman_topicinit.js\" type=\"text/javascript\"></script>\n<script src=\"highlight.js\" type=\"text/javascript\"></script>\n<script type=\"text/javascript\">\n     $(document).ready(function(){highlight();});\n   </script>\n</head>\n<body>\n<script async=\"\" src=\"https://www.googletagmanager.com/gtag/js?id=G-M6ETBEC1R9\"></script><script>window.dataLayer=window.dataLayer || []; function gtag(){dataLayer.push(arguments);}gtag('js', new Date()); gtag('config', 'G-M6ETBEC1R9');</script>\n<script>!function(e,t,c,n,r,a,m){e.ym=e.ym||function(){(e.ym.a=e.ym.a||[]).push(arguments)},e.ym.l=1*new Date;for(var s=0;s<document.scripts.length;s++)if(document.scripts[s].src===n)return;a=t.createElement(c),m=t.getElementsByTagName(c)[0],a.async=1,a.src=n,m.parentNode.insertBefore(a,m)}(window,document,\"script\",\"https://mc.yandex.ru/metrika/tag.js\"),ym(83179930,\"init\",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img alt=\"\" src=\"https://mc.yandex.ru/watch/83179930\" style=\"position:absolute;left:-9999px\"/></div></noscript> \n    \n    ﻿<header class=\"header elma-365\">\n<div class=\"container\">\n<div class=\"nav-container\">\n<div class=\"nav-wrap\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<div class=\"header__navi\">\n<ul class=\"header__list\"><li><span class=\"solution-select\"><span class=\"solution-select__selected\"></span><svg fill=\"none\" height=\"4\" viewbox=\"0 0 7 4\" width=\"7\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M1 1L3.5 3.5L6 1\" stroke=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path></svg><ul class=\"solution-select__list\"><li class=\"header__list-item\"><a class=\"project-link\" href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">CSP</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/crm/crm-functions.html\">CRM+CX</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/kedo/kedo.html\">КЭДО</a></li><li><a class=\"project-link\" href=\"https://elma365.com/ru/help/business_solutions/-elma365-store.html\">Бизнес-решения</a></li><ul class=\"social-links-header\"><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://elma-academy.com/ru/\" target=\"_blank\">Academy</a></li><li class=\"social-link-header\"><a class=\"project-link\" href=\"https://community.elma365.com/ru/\" target=\"_blank\">Community</a></li><li></li></ul></ul></span></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li class=\"header__list-item\"><a class=\"header__list-item-url\" href=\"https://tssdk.elma365.com/latest/\" target=\"_blank\">SDK</a></li><li class=\"header__list-item header__list-item-latest\"><a class=\"header__list-item-url header__list-item-last\" href=\"https://elma365.com/ru/\" target=\"_blank\">Сайт ELMA365</a></li></ul>\n<div class=\"hero-wrap\" style=\"display: flex; align-items: center;\">\n<div class=\"hero__search\" style=\"display: flex; justify-content: space-between; width: 100%; padding-left: 0;\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img alt=\"header logo\" src=\"./logo.svg\"/>\n</a>\n<button class=\"hero__search-icon\" id=\"search-icon\">\n<img alt=\"search string\" src=\"search-icon-white.svg\"/>\n</button>\n<div class=\"hero__search-form\" id=\"search-panel\"><form class=\"search-form\"><label class=\"search-form__label\"><span class=\"search__icon\" id=\"reset-search\" src=\"Union.svg\"></span><input class=\"search-form__input\" type=\"text\"/></label><input class=\"search-form__submit\" type=\"submit\" value=\"Submit\"/></form></div>\n</div>\n</div>\n</div>\n</div>\n<a class=\"hero__side-icon\" href=\"#\" id=\"side-menu-icon\">\n<img alt=\"side menu\" src=\"side_menu.svg\"/>\n</a>\n</div>\n</div>\n</header>\n<main class=\"main container\">\n<aside class=\"sidebar\" id=\"sidebar\">\n<div class=\"sidebar__header\">\n<a class=\"header__logo\" href=\"https://elma365.com/ru/help\">\n<img src=\"./logo-light.svg\"/>\n</a>\n<span class=\"sidebar__close elma-365-close\" id=\"close\"></span>\n</div>\n<div class=\"sidebar__wrapper\" id=\"side-menu\">\n</div>\n</aside>\n<article class=\"article\" id=\"article\">\n<div class=\"article-inner\">\n<div class=\"content\">\n<header class=\"article__header\">\n<div class=\"article__bread\" style=\"display:flex; gap:8px;\">\n<span class=\"search-res__item-category search-res__item-category_subcategory subcategory article__badge\" id=\"subcategory\"></span>\n<nav class=\"topic__breadcrumbs\">\n<p><a href=\"duplicates.html\">Дубли в разделе CRM</a> / Обработка событий в дублях</p>\n</nav>\n</div>\n<div class=\"topic__title\"><h1 class=\"p_Heading1\"><span class=\"f_Heading1\">Обработка событий в дублях</span></h1>\n</div>\n</header>\n<section class=\"article__content\">\n<div class=\"scroll-top-inner\">\n<a class=\"scroll-top\" href=\"#h1-article\"></a>\n</div>\n<!-- Placeholder for topic body. -->\n<p style=\"margin: 7px 0 16px 0;\">Когда в приложении включён поиск похожих элементов, можно создать обработчик событий, который будет отслеживать объединение дублей и запускать нужные действия через скрипт или бизнес-процесс.</p>\n<p style=\"margin: 7px 0 16px 0;\">Настройка обработчика событий осуществляется в рамках создания <a class=\"weblink\" href=\"/ru/help/platform/extentions.html\" target=\"_blank\">пользовательского модуля</a>. В обработчик можно передавать ссылку на основной элемент и запись, отмеченную дублем, а также свойства из их контекста.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">начало внимание</span></p>\n<p style=\"margin: 7px 0 7px 0;\">Обработчик событий для объединения одинаковых записей в приложении доступен при активации <span style=\"font-size: 15px; font-family: Inter;\">платного решения </span><span style=\"font-size: 15px; font-family: Inter; font-weight: bold;\">ELMA365 Управление контрагентами</span><span style=\"font-size: 15px; font-family: Inter;\">, отдельно или в составе одного из</span> <a class=\"weblink\" href=\"/ru/help/platform/licenses-crm.html\" target=\"_blank\">решений CRM</a>, в котором включён поиск дублей. Создавать модуль и настраивать в нём обработчик могут только пользователи, входящие в группу <a class=\"topiclink\" href=\"360006871932.html#administrators\">Администраторы</a>.</p>\n<p class=\"p_CodeExample\" style=\"page-break-inside: avoid;\"><span class=\"f_CodeExample\">конец внимание</span></p>\n<h2 class=\"p_Heading2\"><span class=\"f_Heading2\">Пример обработчика с отслеживанием объединения дублей</span></h2>\n<p>Рассмотрим пример создания обработчика событий для приложений раздела <span style=\"font-weight: bold;\">CRM</span>, в которых включён поиск дублей. </p>\n<p style=\"margin: 16px 0 0 0;\">Например, пользователь находит два элемента с одинаковыми данными и объединяет их в одну запись. Добавленный обработчик события фиксирует это действие и запускает процесс. В его ходе с помощью скриптов передаются данные об основном и объединённом элементе. Затем ответственному менеджеру и его руководителю отправляется задача ознакомления со списком объединённых дублей.</p>\n<p style=\"margin: 16px 0 0 0;\">Для настройки обработчика выполните следующие действия:</p>\n<ol style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\" value=\"1\">Перейдите в раздел <span style=\"font-weight: bold;\">Администрирование &gt; Модули</span> и <a class=\"topiclink\" href=\"create-extention.html\">создайте пользовательский модуль</a>.</li><li style=\"margin-top: 0; margin-right: 0; margin-bottom: 23px;\" value=\"2\">В настройках модуля перейдите на вкладку <span style=\"font-weight: bold;\">Процессы</span> и добавьте <a class=\"topiclink\" href=\"extention-processes.html\">бизнес-процесс</a>, который будет выполняться каждый раз после объединения записей-дублей.</li></ol>\n<p style=\"margin: 0 0 23px 36px;\">Для нашего примера добавим процесс <span style=\"font-weight: bold;\">Уведомление об объединении дублей</span> и настроим его схему следующим образом:</p>\n<p style=\"margin: 0 0 23px 36px;\"><img alt=\"duplicates-events-processing-1\" height=\"272\" src=\"duplicates-events-processing-1.png\" style=\"margin:0;width:667px;height:272px;border:none\" width=\"667\"/></p>\n<ol start=\"3\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\" value=\"3\">В дизайнере бизнес-процессов перейдите на вкладку <span style=\"font-weight: bold;\">Контекст</span> и добавьте переменные, в которые обработчик в результате слияния дублей передаст ссылки на основной элемент и объединённые записи:</li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\"><span style=\"font-weight: bold;\">Объединенный элемент</span> — свойство типа <span style=\"font-weight: bold;\">Произвольное приложение (один)</span>;</li><li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\"><span style=\"font-weight: bold;\">Дубликаты</span> — свойства типа <span style=\"font-weight: bold;\">Произвольное приложение (несколько)</span>.</li></ul>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\" value=\"4\">На вкладке <span style=\"font-weight: bold;\">Схема</span> разместите два блока <a class=\"weblink\" href=\"/ru/help/platform/360027203731.html\" target=\"_blank\">Скрипт</a> и задайте в них функции, с помощью которых будет определяться основной элемент и его записи-дубли.</li></ol>\n<p style=\"margin: 0 0 0 24px;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A1')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">1. Пример скрипта для получения данных о дублях</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A1\" style=\"text-align: left; padding: 0 0 0 0; margin: 0 0 0 24px;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: auto; page-break-after: avoid;\"><span class=\"f_CodeExample\">async</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">function</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">getDoubles():</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Promise&lt;void&gt;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">{</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">// Context.data.doubles — переменная Дубликаты из контекста процесса Уведомление об объединении дублей.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">// Когда создаётся обработчик события, в нём выполняются настройки, с помощью которых в эту переменную записываются все объединяемые в процессе поиска дублей элементы.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">// Чтобы узнать, к какому приложению относятся дубли, и определить, к каким свойствам можно обращаться внутри сценария, нужно получить первый элемент списка Context.data.doubles и прочитать его свойство code:</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">element</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">await</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.doubles![0].fetch(); // Получаем первый элемент списка Context.data.doubles.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">doubles_app_code</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">element.code; // Читаем свойство code.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">// При помощи проверки значения свойства code, можно сформировать пользовательский сценарий обработки элементов для каждого приложения, в котором активирован поиск дублей:</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">switch(doubles_app_code)</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">{</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">        </span><span class=\"f_CodeExample\">case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_opportunities\":</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">// Создаём в контексте бизнес-процесса переменную Дубли лиды (тип: Приложение &gt; Лиды с опцией Несколько, код для обращения: Context.data.opportunities_doubles). В ней сохраняются ссылки на записи‑дубли, если тип элементов — лиды:</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">Context.data.opportunities_doubles</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.doubles</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">as</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">BaseApplicationItem&lt;Application$_clients$_opportunities$Data,</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Application$_clients$_opportunities$Params&gt;[];</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">// Теперь можно обрабатывать дубли в приложении Лиды:</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">for</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">(let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">i</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">0;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">i</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">&lt;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.opportunities_doubles!.length;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">i++)</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">{</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">                </span><span class=\"f_CodeExample\">let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">opportunity_double</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">await</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.opportunities_doubles[i].fetch(); // Получаем элемент в цикле</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">                </span><span class=\"f_CodeExample\">let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">opportunity_name</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">opportunity_double.data.__name; // Получаем имя элемента. Аналогичным образом доступны значения других свойств приложения.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">}</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">break;</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">        </span><span class=\"f_CodeExample\">case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_leads\":</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">// При обращении к этому приложению может быть реализована обработка дублей‑сделок.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">break;</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">        </span><span class=\"f_CodeExample\">case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_companies\":</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">// При обращении к этому приложению может быть реализована обработка дублей‑компаний.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">break;</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">        </span><span class=\"f_CodeExample\">case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_contacts\":</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">// При обращении к этому приложению может быть реализована обработка дублей‑контактов.</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">            </span><span class=\"f_CodeExample\">break;</span><br/>\n<span class=\"f_CodeExample\" style=\"color: #ffffff;\">    </span><span class=\"f_CodeExample\">}</span><br/>\n<span class=\"f_CodeExample\">}</span></p>\n</td>\n</tr>\n</table>\n</div>\n<p style=\"margin: 0 0 0 24px;\"><a class=\"dropdown-toggle\" href=\"javascript:HMToggle('toggle','TOGGLE0186A2')\" style=\"font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;\">2. Пример скрипта для получения данных об основном (объединённом) элементе</a></p>\n<div class=\"dropdown-toggle-body\" id=\"TOGGLE0186A2\" style=\"text-align: left; padding: 0 0 0 0; margin: 0 0 0 24px;\"><table style=\"border:none; border-spacing:0;\">\n<tr>\n<td style=\"vertical-align:top; padding:0; border:none\"><p class=\"p_CodeExample\" style=\"white-space: normal; page-break-inside: auto; page-break-after: avoid;\"><span class=\"f_CodeExample\">async</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">function</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">getMainElement():</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Promise&lt;void&gt;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">{</span><br/>\n<span class=\"f_CodeExample\">    // Обработка главного (объединённого) элемента аналогична обработке записей‑дублей. Главным отличием является то, что дубликатов всегда несколько, а главный элемент — один.</span><br/>\n<span class=\"f_CodeExample\">    let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">element</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">await</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.main_element!.fetch();</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">// Получаем первый элемент списка Context.data.doubles.</span><br/>\n<span class=\"f_CodeExample\">    let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">doubles_app_code</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">element.code;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">// Читаем свойство code.</span><br/>\n<span class=\"f_CodeExample\">    // При помощи проверки значения свойства code, можно сформировать пользовательский сценарий обработки элементов для каждого приложения, в котором активирован поиск дублей:</span><br/>\n<span class=\"f_CodeExample\">    switch(doubles_app_code)</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">{</span><br/>\n<span class=\"f_CodeExample\">        case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_opportunities\":</span><br/>\n<span class=\"f_CodeExample\">        // Создаём в контексте бизнес-процесса переменную Основной элемент лид (тип: Приложение &gt; Лиды с опцией Один, код для обращения: Context.data.opportunity_main_element). В ней сохраняется ссылка на основной элемент — лид:</span><br/>\n<span class=\"f_CodeExample\">        Context.data.main_element_opportunity</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.main_element!</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">as</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">BaseApplicationItem&lt;Application$_clients$_opportunities$Data,</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Application$_clients$_opportunities$Params&gt;;</span><br/>\n<span class=\"f_CodeExample\">        // Теперь можно обрабатывать основной элемент приложения Лиды:</span><br/>\n<span class=\"f_CodeExample\">        let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">main_element_opportunity</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">await</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">Context.data.main_element_opportunity.fetch();</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">// Получаем элемен.т</span><br/>\n<span class=\"f_CodeExample\">        let</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">main_opportunity_name</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">=</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">main_element_opportunity.data.__name;</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">// Получаем имя элемента. Аналогичным образом доступны значения других свойств приложения</span><br/>\n<span class=\"f_CodeExample\">            break;</span><br/>\n<span class=\"f_CodeExample\">        case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_leads\":</span><br/>\n<span class=\"f_CodeExample\">        // При обращении к этому приложению может быть реализована обработка дублей‑сделок.</span><br/>\n<span class=\"f_CodeExample\">            break;</span><br/>\n<span class=\"f_CodeExample\">        case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_companies\":</span><br/>\n<span class=\"f_CodeExample\">            // При обращении к этому приложению может быть реализована обработка дублей‑компаний.</span><br/>\n<span class=\"f_CodeExample\">            break;</span><br/>\n<span class=\"f_CodeExample\">        case</span><span class=\"f_CodeExample\" style=\"color: #ffffff;\"> </span><span class=\"f_CodeExample\">\"_contacts\":</span><br/>\n<span class=\"f_CodeExample\">            // При обращении к этому приложению может быть реализована обработка дублей‑контактов.</span><br/>\n<span class=\"f_CodeExample\">            break;</span><br/>\n<span class=\"f_CodeExample\">    }</span><br/>\n<span class=\"f_CodeExample\">}</span></p>\n</td>\n</tr>\n</table>\n</div>\n<ol start=\"4\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 0; margin-right: 0; margin-bottom: 0;\" value=\"5\">Поскольку участники процесса будут определяться в его ходе, на схеме процесса создайте <a class=\"weblink\" href=\"/ru/help/platform/360012263032.html#dynamic\" target=\"_blank\">динамические зоны ответственности</a>: </li></ol>\n<ul style=\"list-style-type:disc\">\n<li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\">для отвечающих за элемент приложения сотрудников;</li><li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\">для руководителя отдела продаж.  </li></ul>\n<ol start=\"6\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\" value=\"6\">Чтобы сотрудники могли ознакомиться со списком дублей, найденных обработчиком события, в зонах ответственности разместите блоки <a class=\"weblink\" href=\"/ru/help/platform/360012495611.html\" target=\"_blank\">Задача</a> и добавьте на форму задачи переменные <span style=\"font-weight: bold;\">Объединенный элемент</span> и <span style=\"font-weight: bold;\">Дубликаты</span>.</li><li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\" value=\"7\">Сохраните и опубликуйте процесс. </li><li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\" value=\"8\">В настройках модуля перейдите на вкладку <a class=\"weblink\" href=\"/ru/help/platform/events_processing.html\" target=\"_blank\">Обработка событий</a>. Добавьте обработчик, указав: название, домен события — <span style=\"font-weight: bold;\">Дубли</span>, событие — <span style=\"font-weight: bold;\">Объединение дубликатов</span>, тип обработчика — <span style=\"font-weight: bold;\">Запуск процесса</span>.</li></ol>\n<p style=\"text-indent: 1px; margin: 23px 0 0 36px;\"><img alt=\"duplicates-events-processing-2\" height=\"287\" src=\"duplicates-events-processing-2.png\" style=\"margin:0;width:518px;height:287px;border:none\" width=\"518\"/></p>\n<ol start=\"6\" style=\"list-style-type:upper-roman\">\n<li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\" value=\"9\">На открывшейся странице настроек обработчика событий укажите процесс, созданный ранее внутри пользовательского модуля.</li><li style=\"margin-top: 23px; margin-right: 0; margin-bottom: 0;\" value=\"10\">Перейдите на вкладку <span style=\"font-weight: bold;\">Входные переменные</span> и назначьте источники данных для переменных из контекста процесса в колонке <span style=\"font-weight: bold;\">Поле элемента</span>. Для этого сопоставьте их со свойствами события. </li></ol>\n<p style=\"margin: 0 0 0 36px;\">Для события <span style=\"font-weight: bold;\">Объединение дубликатов</span> предусмотрен набор системных полей (идентификатор события, время выполнения, название объекта, автор и т. д.), а также индивидуальные свойства: ссылка на основной элемент и дубликаты. Для нашего примера необходимо сопоставить переменные <span style=\"font-weight: bold;\">Дубликаты</span> и <span style=\"font-weight: bold;\">Объединённый элемент</span>.</p>\n<p style=\"margin: 0 0 0 36px;\"><img alt=\"duplicates-events-processing-3\" height=\"195\" src=\"duplicates-events-processing-3.png\" style=\"margin:0;width:814px;height:195px;border:none\" width=\"814\"/></p>\n<p style=\"margin: 0 0 0 36px;\">Обратите внимание,<span style=\"font-weight: bold;\"> </span>на вкладке <span style=\"font-weight: bold;\">Входные переменные</span> отображаются свойства, присутствующие в контексте процесса в момент его привязки к обработчику события. Если контекст процесса был изменён, новые переменные не появятся в настройках обработчика. Необходимо повторно создать и настроить обработчик событий, привязав к нему тот же самый бизнес-процесс.</p>\n<ol start=\"11\" style=\"list-style-type:upper-roman\">\n<li value=\"11\">На верхней панели страницы настроек нажмите <span style=\"font-weight: bold;\">Сохранить</span> и <span style=\"font-weight: bold;\">Опубликовать</span>, чтобы активировать обработчик событий.</li><li value=\"12\">Вернитесь на основную страницу модуля и включите его.</li></ol>\n<p style=\"margin: 23px 0 23px 0;\">Теперь, когда пользователь объединит между собой несколько элементов-дублей, в системе сработает обработчик событий, который запустит настроенный бизнес-процесс. Ответственные<span style=\"color: #394149; background-color: #ffffff;\"> сотрудники и руководитель отдела ознакомятся с похожими записями на форме отдельных задач.</span></p>\n<div class=\"bottom-nav\">\n<a class=\"topic__navi_prev\" href=\"mark-as-duplicate.html\" id=\"prev-link\">\n<span class=\"bottom-nav__arrow bottom-nav__arrow--prev\"></span> <span class=\"bottom-nav__link\">mark-as-duplicate.html</span>\n</a>\n<a class=\"topic__navi_next\" href=\"cash-flow.html\" id=\"next-link\">\n<span class=\"bottom-nav__link\">cash-flow.html</span> <span class=\"bottom-nav__arrow bottom-nav__arrow--next\"></span>\n</a>\n</div>\n<!-- добавляет на страницу строку блок Была ли статья полезной?  -->\n<div class=\"feedback-wrap\"><div class=\"feedback\" id=\"feedback\"><span><b>Была ли статья полезной?</b></span><form action=\"\" class=\"feedback-form\" id=\"feedback-form\" method=\"POST\"><div class=\"feedback__popup feedback__popup-response\" id=\"feedback__popup_thx\">Спасибо за ваш отзыв!</div><div id=\"feedback-success-popup\"><div class=\"wrap\"><button class=\"feedback-popup-close\" type=\"button\">×</button><svg fill=\"none\" height=\"44\" viewbox=\"0 0 44 44\" width=\"44\" xmlns=\"http://www.w3.org/2000/svg\"><g clip-path=\"url(#clip0_212_2187)\"><path d=\"M22 0.6875C10.2294 0.6875 0.6875 10.2294 0.6875 22C0.6875 33.7706 10.2294 43.3125 22 43.3125C33.7706 43.3125 43.3125 33.7706 43.3125 22C43.3125 10.2294 33.7706 0.6875 22 0.6875ZM22 40.5625C11.8023 40.5625 3.4375 32.3078 3.4375 22C3.4375 11.8024 11.6922 3.4375 22 3.4375C32.1977 3.4375 40.5625 11.6922 40.5625 22C40.5625 32.1976 32.3078 40.5625 22 40.5625ZM34.1713 16.933L18.6613 32.3186C18.257 32.7197 17.604 32.7171 17.203 32.3128L9.82283 24.873C9.42176 24.4686 9.42434 23.8157 9.82867 23.4146L10.5609 22.6884C10.9652 22.2873 11.6181 22.2899 12.0192 22.6942L17.9468 28.6697L31.9926 14.7366C32.3969 14.3356 33.0498 14.3382 33.4509 14.7425L34.1772 15.4747C34.5783 15.879 34.5757 16.532 34.1713 16.933Z\" fill=\"#27AE60\"></path></g><defs><clippath id=\"clip0_212_2187\"><rect fill=\"white\" height=\"44\" width=\"44\"></rect></clippath></defs></svg><p>Ваш отзыв успешно отправлен!</p><span>Спасибо за обратную связь.</span></div></div><div class=\"feedback__popup\" id=\"feedback__popup_why\"><button class=\"feedback-popup-close\" type=\"button\">×</button><div class=\"feedback__popup-header\">Уточните, почему:</div><input id=\"bad_recommendation\" name=\"category\" type=\"radio\" value=\"bad_recommendation\"/><label for=\"bad_recommendation\">Рекомендации не помогли</label><input id=\"difficult_text\" name=\"category\" type=\"radio\" value=\"difficult_text\"/><label for=\"difficult_text\">Текст трудно понять</label><input id=\"no_answer\" name=\"category\" type=\"radio\" value=\"no_answer\"/><label for=\"no_answer\">Нет ответа на мой вопрос</label><input id=\"bad_header\" name=\"category\" type=\"radio\" value=\"bad_header\"/><label for=\"bad_header\">Содержание статьи не соответствует заголовку</label><input id=\"other_reason\" name=\"category\" type=\"radio\" value=\"other_reason\"/><label for=\"other_reason\">Другая причина</label></div><div class=\"feedback__popup\" id=\"feedback__popup-other\"><button class=\"feedback-popup-close\" type=\"button\">×</button> <div class=\"feedback__popup-header\">Расскажите, что вам не понравилось в статье:</div><textarea class=\"feedback__textarea\" id=\"\" name=\"other\"></textarea><input class=\"feedback__other-btn\" type=\"submit\" value=\"Отправить\"/></div><div class=\"feedback-form__btn-group\"><input id=\"feedback__useful_yes\" name=\"useful\" type=\"radio\" value=\"true\"/><label for=\"feedback__useful_yes\"><img src=\"like.svg\"/><span class=\"feedback-form__btn-group_yes-btn\">Да</span></label><input id=\"feedback__useful_no\" name=\"useful\" type=\"radio\" value=\"false\"/><label for=\"feedback__useful_no\"><img src=\"dislike.svg\"/><span class=\"feedback-form__btn-group_no-btn\">Нет</span></label></div><select name=\"category\"><option disabled=\"\">Выберите вариант</option><option selected=\"\" value=\"bad_recommendation\">Рекомендации не помогли</option><option value=\"difficult_text\">Текст трудно понять</option><option value=\"no_answer\">Нет ответа на мой вопрос</option><option value=\"bad_header\">Содержание статьи не соответствует заголовку</option><option value=\"other_reason\">Другая причина</option></select><input type=\"submit\"/></form></div></div>\n</section>\n</div>\n<aside class=\"article__sidebar\" style=\"display:none\">\n<input type=\"checkbox\"/>\n<div class=\"article__arrow\"></div>\n<div class=\"table-of-contents elma365-right\" id=\"toc2Content\">\n<h3 class=\"h3-toc\">В этой статье</h3>\n<nav id=\"toc2\"></nav>\n</div>\n</aside>\n</div>\n</article>\n</main>\n<footer class=\"footer\">\n<div class=\"footer-container\">\n<div class=\"footer-mobile\">\n<ul class=\"footer-mobile__list\"><li><a href=\"https://api.elma365.com/ru/\" target=\"_blank\">API</a></li><li><a href=\"https://tssdk.elma365.com/\" target=\"_blank\">TS SDK</a></li><li><a href=\"https://community.elma365.com/\" target=\"_blank\">Community</a></li><li><a href=\"https://elma-academy.com/ru/elma365\" target=\"_blank\">Академия</a></li></ul><ul class=\"footer-mobile__list\"><li><a href=\"https://elma365.com/ru/help/platform/get-trial.html\">Платформа</a></li><li><a href=\"https://elma365.com/ru/help/ecm/ecm-functions.html\">ECM</a></li><li><a href=\"https://elma365.com/ru/help/service/service-functions.html\">Service</a></li><li><a href=\"https://elma365.com/ru/help/projects/projects-functions.html\">Проекты</a></li></ul>\n</div>\n<div class=\"container\">\n<div class=\"footer-wrap\">\n<div><span class=\"mobile-question-popup\">Отправить фидбэк</span><form action=\"\" class=\"question__popup question-xs\" id=\"question__popup\" method=\"POST\"><div class=\"question-wrap\"><span class=\"close\"></span><span class=\"title\">Задать вопрос</span><label for=\"help_question\" style=\"display: none;\"></label><textarea id=\"help_question\" name=\"help_question\"></textarea><input type=\"submit\" value=\"Отправить\"/></div></form><div class=\"hidden fade-in question-success-xs\">Ваш фидбэк отправлен.</div></div>\n<div class=\"footer-flex-b\">\n<div class=\"footer-top\">\n<span class=\"footer-copy\">© 2025 \n              ELMA365\n            \n            \n          </span>\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</div>\n<div class=\"footer-line\">\n<div class=\"footer-line-copy\">\n<span class=\"footer-copy\">© 2025 \n                  ELMA365\n                \n                \n              </span>\n</div>\n<ul class=\"footer-list\">\n<li class=\"footer-item footer-url-elma\"><a class=\"footer-link footer-url-link-elma\" href=\"https://elma365.com/ru/\" style=\"color: #0D4A75;\" target=\"_blank\"><img alt=\"browse icon\" class=\"footer-img footer-img-elma-url\" src=\"browse.svg\"/>elma365.com</a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vkvideo.ru/@elma_bpm\" target=\"_blank\"><img alt=\"vk-video icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk-video.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://vk.com/elma_bpm\" target=\"_blank\"><img alt=\"vk icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"vk.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://t.me/elmaday\" target=\"_blank\"><img alt=\"telegram icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"telegram.svg\" width=\"20\"/></a></li><li class=\"footer-item\"><a class=\"footer-link\" href=\"https://dzen.ru/elma\" target=\"_blank\"><img alt=\"dzen icon\" class=\"footer-img social-footer-img\" height=\"20\" src=\"social_dzen.svg\" width=\"20\"/></a></li>\n<li class=\"footer-item sk-footer-img\">\n<a class=\"sk-img\" href=\"https://navigator.sk.ru/orn/1122971\" target=\"_blank\">\n<img alt=\"sk icon\" class=\"footer-img\" height=\"34\" src=\"sk-resident.svg\" width=\"117\"/>\n</a>\n</li>\n</ul>\n</div>\n</div>\n</div>\n</div>\n<a class=\"arrow-top\" href=\"#\"></a>\n</div>\n</footer>\n<!--    <script type=\"text/javascript\" src=\"jquery1.min.js\"></script>-->\n<iframe name=\"hmnavigation\" style=\"display:none!important\"></iframe>\n<!--<script src=\"./jquery-ui.js\"></script> -->\n<script src=\"./jquery-ui.min.js\"></script>\n<!--script src=\"//cdn.jsdelivr.net/npm/featherlight@1.7.14/release/featherlight.min.js\" type=\"text/javascript\" charset=\"utf-8\"></script-->\n<script src=\"./jquery.tocify.min.js\"></script>\n<script src=\"./TypoReporter.min.js\"></script>\n<script src=\"./google-search.js\"></script>\n<script src=\"./main.js\"></script>\n<script type=\"text/javascript\">\nHMInitToggle('TOGGLE0186A1','hm.type','dropdown','hm.state','0');\nHMInitToggle('TOGGLE0186A2','hm.type','dropdown','hm.state','0');\n</script>\n</body>\n</html>\n",
  "plain_text": "Обработка событий в дублях ﻿ Платформа CSP CRM+CX Проекты Service КЭДО Бизнес-решения Academy Community API SDK Сайт ELMA365 Дубли в разделе CRM / Обработка событий в дублях Обработка событий в дублях Когда в приложении включён поиск похожих элементов, можно создать обработчик событий, который будет отслеживать объединение дублей и запускать нужные действия через скрипт или бизнес-процесс. Настройка обработчика событий осуществляется в рамках создания пользовательского модуля . В обработчик можно передавать ссылку на основной элемент и запись, отмеченную дублем, а также свойства из их контекста. начало внимание Обработчик событий для объединения одинаковых записей в приложении доступен при активации платного решения ELMA365 Управление контрагентами , отдельно или в составе одного из решений CRM , в котором включён поиск дублей. Создавать модуль и настраивать в нём обработчик могут только пользователи, входящие в группу Администраторы . конец внимание Пример обработчика с отслеживанием объединения дублей Рассмотрим пример создания обработчика событий для приложений раздела CRM , в которых включён поиск дублей. Например, пользователь находит два элемента с одинаковыми данными и объединяет их в одну запись. Добавленный обработчик события фиксирует это действие и запускает процесс. В его ходе с помощью скриптов передаются данные об основном и объединённом элементе. Затем ответственному менеджеру и его руководителю отправляется задача ознакомления со списком объединённых дублей. Для настройки обработчика выполните следующие действия: Перейдите в раздел Администрирование > Модули и создайте пользовательский модуль . В настройках модуля перейдите на вкладку Процессы и добавьте бизнес-процесс , который будет выполняться каждый раз после объединения записей-дублей. Для нашего примера добавим процесс Уведомление об объединении дублей и настроим его схему следующим образом: В дизайнере бизнес-процессов перейдите на вкладку Контекст и добавьте переменные, в которые обработчик в результате слияния дублей передаст ссылки на основной элемент и объединённые записи: Объединенный элемент — свойство типа Произвольное приложение (один) ; Дубликаты — свойства типа Произвольное приложение (несколько) . На вкладке Схема разместите два блока Скрипт и задайте в них функции, с помощью которых будет определяться основной элемент и его записи-дубли. 1. Пример скрипта для получения данных о дублях async function getDoubles(): Promise<void> { // Context.data.doubles — переменная Дубликаты из контекста процесса Уведомление об объединении дублей. // Когда создаётся обработчик события, в нём выполняются настройки, с помощью которых в эту переменную записываются все объединяемые в процессе поиска дублей элементы. // Чтобы узнать, к какому приложению относятся дубли, и определить, к каким свойствам можно обращаться внутри сценария, нужно получить первый элемент списка Context.data.doubles и прочитать его свойство code: let element = await Context.data.doubles![0].fetch(); // Получаем первый элемент списка Context.data.doubles. let doubles_app_code = element.code; // Читаем свойство code. // При помощи проверки значения свойства code, можно сформировать пользовательский сценарий обработки элементов для каждого приложения, в котором активирован поиск дублей: switch(doubles_app_code) { case \"_opportunities\": // Создаём в контексте бизнес-процесса переменную Дубли лиды (тип: Приложение > Лиды с опцией Несколько, код для обращения: Context.data.opportunities_doubles). В ней сохраняются ссылки на записи‑дубли, если тип элементов — лиды: Context.data.opportunities_doubles = Context.data.doubles as BaseApplicationItem<Application$_clients$_opportunities$Data, Application$_clients$_opportunities$Params>[]; // Теперь можно обрабатывать дубли в приложении Лиды: for (let i = 0; i < Context.data.opportunities_doubles!.length; i++) { let opportunity_double = await Context.data.opportunities_doubles[i].fetch(); // Получаем элемент в цикле let opportunity_name = opportunity_double.data.__name; // Получаем имя элемента. Аналогичным образом доступны значения других свойств приложения. } break; case \"_leads\": // При обращении к этому приложению может быть реализована обработка дублей‑сделок. break; case \"_companies\": // При обращении к этому приложению может быть реализована обработка дублей‑компаний. break; case \"_contacts\": // При обращении к этому приложению может быть реализована обработка дублей‑контактов. break; } } 2. Пример скрипта для получения данных об основном (объединённом) элементе async function getMainElement(): Promise<void> { // Обработка главного (объединённого) элемента аналогична обработке записей‑дублей. Главным отличием является то, что дубликатов всегда несколько, а главный элемент — один. let element = await Context.data.main_element!.fetch(); // Получаем первый элемент списка Context.data.doubles. let doubles_app_code = element.code; // Читаем свойство code. // При помощи проверки значения свойства code, можно сформировать пользовательский сценарий обработки элементов для каждого приложения, в котором активирован поиск дублей: switch(doubles_app_code) { case \"_opportunities\": // Создаём в контексте бизнес-процесса переменную Основной элемент лид (тип: Приложение > Лиды с опцией Один, код для обращения: Context.data.opportunity_main_element). В ней сохраняется ссылка на основной элемент — лид: Context.data.main_element_opportunity = Context.data.main_element! as BaseApplicationItem<Application$_clients$_opportunities$Data, Application$_clients$_opportunities$Params>; // Теперь можно обрабатывать основной элемент приложения Лиды: let main_element_opportunity = await Context.data.main_element_opportunity.fetch(); // Получаем элемен.т let main_opportunity_name = main_element_opportunity.data.__name; // Получаем имя элемента. Аналогичным образом доступны значения других свойств приложения break; case \"_leads\": // При обращении к этому приложению может быть реализована обработка дублей‑сделок. break; case \"_companies\": // При обращении к этому приложению может быть реализована обработка дублей‑компаний. break; case \"_contacts\": // При обращении к этому приложению может быть реализована обработка дублей‑контактов. break; } } Поскольку участники процесса будут определяться в его ходе, на схеме процесса создайте динамические зоны ответственности : для отвечающих за элемент приложения сотрудников; для руководителя отдела продаж. Чтобы сотрудники могли ознакомиться со списком дублей, найденных обработчиком события, в зонах ответственности разместите блоки Задача и добавьте на форму задачи переменные Объединенный элемент и Дубликаты . Сохраните и опубликуйте процесс. В настройках модуля перейдите на вкладку Обработка событий . Добавьте обработчик, указав: название, домен события — Дубли , событие — Объединение дубликатов , тип обработчика — Запуск процесса . На открывшейся странице настроек обработчика событий укажите процесс, созданный ранее внутри пользовательского модуля. Перейдите на вкладку Входные переменные и назначьте источники данных для переменных из контекста процесса в колонке Поле элемента . Для этого сопоставьте их со свойствами события. Для события Объединение дубликатов предусмотрен набор системных полей (идентификатор события, время выполнения, название объекта, автор и т. д.), а также индивидуальные свойства: ссылка на основной элемент и дубликаты. Для нашего примера необходимо сопоставить переменные Дубликаты и Объединённый элемент . Обратите внимание, на вкладке Входные переменные отображаются свойства, присутствующие в контексте процесса в момент его привязки к обработчику события. Если контекст процесса был изменён, новые переменные не появятся в настройках обработчика. Необходимо повторно создать и настроить обработчик событий, привязав к нему тот же самый бизнес-процесс. На верхней панели страницы настроек нажмите Сохранить и Опубликовать , чтобы активировать обработчик событий. Вернитесь на основную страницу модуля и включите его. Теперь, когда пользователь объединит между собой несколько элементов-дублей, в системе сработает обработчик событий, который запустит настроенный бизнес-процесс. Ответственные сотрудники и руководитель отдела ознакомятся с похожими записями на форме отдельных задач. mark-as-duplicate.html cash-flow.html Была ли статья полезной? Спасибо за ваш отзыв! × Ваш отзыв успешно отправлен! Спасибо за обратную связь. × Уточните, почему: Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина × Расскажите, что вам не понравилось в статье: Да Нет Выберите вариант Рекомендации не помогли Текст трудно понять Нет ответа на мой вопрос Содержание статьи не соответствует заголовку Другая причина В этой статье API TS SDK Community Академия Платформа ECM Service Проекты Отправить фидбэк Задать вопрос Ваш фидбэк отправлен. © 2025 ELMA365 © 2025 ELMA365 elma365.com",
  "links": [
    "https://elma365.com/ru/help",
    "https://elma365.com/ru/help/platform/get-trial.html",
    "https://elma365.com/ru/help/ecm/ecm-functions.html",
    "https://elma365.com/ru/help/crm/crm-functions.html",
    "https://elma365.com/ru/help/projects/projects-functions.html",
    "https://elma365.com/ru/help/service/service-functions.html",
    "https://elma365.com/ru/help/kedo/kedo.html",
    "https://elma365.com/ru/help/business_solutions/-elma365-store.html",
    "https://elma-academy.com/ru/",
    "https://community.elma365.com/ru/",
    "https://api.elma365.com/ru/",
    "https://tssdk.elma365.com/latest/",
    "https://elma365.com/ru/",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/duplicates.html",
    "https://elma365.com/ru/help/platform/extentions.html",
    "https://elma365.com/ru/help/platform/licenses-crm.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/360006871932.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/create-extention.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/extention-processes.html",
    "https://elma365.com/ru/help/platform/360027203731.html",
    "https://elma365.com/ru/help/platform/360012263032.html",
    "https://elma365.com/ru/help/platform/360012495611.html",
    "https://elma365.com/ru/help/platform/events_processing.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/mark-as-duplicate.html",
    "https://elma365.com/ru/help/business_solutions/ /ru/help/platform/cash-flow.html",
    "https://tssdk.elma365.com/",
    "https://community.elma365.com/",
    "https://elma-academy.com/ru/elma365",
    "https://navigator.sk.ru/orn/1122971",
    "https://vkvideo.ru/@elma_bpm",
    "https://vk.com/elma_bpm",
    "https://t.me/elmaday",
    "https://dzen.ru/elma"
  ],
  "last_crawled": "2025-11-29T22:02:18.198281",
  "metadata": {
    "depth": 10,
    "saved_at": "2025-11-29T22:02:18.286084"
  }
}